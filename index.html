<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Jetbrains+Mono:300,300italic,400,400italic,700,700italic%7CHeiti:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-material.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"dawn-cmd.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="history of blood and tear">
<meta property="og:type" content="website">
<meta property="og:title" content="Developer Biography">
<meta property="og:url" content="https://dawn-cmd.github.io/index.html">
<meta property="og:site_name" content="Developer Biography">
<meta property="og:description" content="history of blood and tear">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="HuaiYuan Jing">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://dawn-cmd.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Developer Biography - action speaks louder than word</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Developer Biography" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Developer Biography</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">action speaks louder than word</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="Searching..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="HuaiYuan Jing" src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">HuaiYuan Jing</p>
  <div class="site-description" itemprop="description">history of blood and tear</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">7</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/dawn-cmd" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;dawn-cmd" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ls.hyjing@gmail.com" title="E-Mail → mailto:ls.hyjing@gmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="external nofollow noopener noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://dawn-cmd.github.io/2024/02/11/Solution-of-Cantina-of-Babel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="HuaiYuan Jing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Developer Biography">
      <meta itemprop="description" content="history of blood and tear">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Developer Biography">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/11/Solution-of-Cantina-of-Babel/" class="post-title-link" itemprop="url">Solution of Cantina of Babel</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-11 17:08:33" itemprop="dateCreated datePublished" datetime="2024-02-11T17:08:33-06:00">2024-02-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-12 10:02:32" itemprop="dateModified" datetime="2024-02-12T10:02:32-06:00">2024-02-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFS/" itemprop="url" rel="index"><span itemprop="name">DFS</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFS/Disjoint-Union-Set/" itemprop="url" rel="index"><span itemprop="name">Disjoint Union Set</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFS/Disjoint-Union-Set/ICPC/" itemprop="url" rel="index"><span itemprop="name">ICPC</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFS/Disjoint-Union-Set/ICPC/Kattis/" itemprop="url" rel="index"><span itemprop="name">Kattis</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFS/Disjoint-Union-Set/ICPC/Kattis/Connective/" itemprop="url" rel="index"><span itemprop="name">Connective</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFS/Disjoint-Union-Set/ICPC/Kattis/Connective/Rust/" itemprop="url" rel="index"><span itemprop="name">Rust</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Problem-Description"><a href="#Problem-Description" class="headerlink" title="Problem Description"></a>Problem Description</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://open.kattis.com/problems/cantinaofbabel">link</a></p>
<h2 id="Problem-Analysis"><a href="#Problem-Analysis" class="headerlink" title="Problem Analysis"></a>Problem Analysis</h2><p>We can divide all people into different sets based on the languages they understand and speak. Everyone in a set can communicate with others in the same set—that is, they can understand the languages spoken by each other. Finally, we subtract the number of people in the largest set from the total number of people, which gives us the minimum number of people that need to be excluded.</p>
<h2 id="Step-1-Convert-Strings-to-IDs"><a href="#Step-1-Convert-Strings-to-IDs" class="headerlink" title="Step 1: Convert Strings to IDs"></a>Step 1: Convert Strings to IDs</h2><p>All the information provided in the input appears in string form, which is extremely inconvenient for graph construction and traversal. Therefore, we first record strings and assign corresponding IDs using a dictionary and an array.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">build_language_dict</span>(people: &amp;<span class="type">Vec</span>&lt;Person&gt;) <span class="punctuation">-&gt;</span> HashMap&lt;&amp;<span class="type">String</span>, <span class="type">usize</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">lang_dict</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num_of_lang</span> = <span class="number">0usize</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">person</span> <span class="keyword">in</span> people &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">lang</span> <span class="keyword">in</span> person.understand.<span class="title function_ invoke__">borrow</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span> lang_dict.<span class="title function_ invoke__">contains_key</span>(lang) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            lang_dict.<span class="title function_ invoke__">insert</span>(lang, num_of_lang);</span><br><span class="line">            num_of_lang += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    lang_dict</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">record_people</span>(n: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;Person&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">people</span>: <span class="type">Vec</span>&lt;Person&gt; = <span class="built_in">vec!</span>[];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..n &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">input</span> = <span class="title function_ invoke__">read_line_of_string</span>();</span><br><span class="line">        people.<span class="title function_ invoke__">push</span>(Person &#123;</span><br><span class="line">            speak: input[<span class="number">1</span>].<span class="title function_ invoke__">to_owned</span>(),</span><br><span class="line">            understand: HashSet::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">id</span> = people.<span class="title function_ invoke__">len</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..input.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">            people[id].understand.<span class="title function_ invoke__">insert</span>(input[i].<span class="title function_ invoke__">clone</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    people</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>record_people</code> function records each line of input, then converts them into <code>Person</code> structs and stores them in the <code>people</code> array, allowing direct access to each person via their ID later. The <code>build_language_dict</code> function creates a <code>HashMap</code> with <code>String</code> keys and <code>usize</code> values, enabling us to find the corresponding value by language name. After converting all strings to IDs, we can begin constructing the graph.</p>
<h2 id="Step-2-Construct-the-Language-Conversion-Graph"><a href="#Step-2-Construct-the-Language-Conversion-Graph" class="headerlink" title="Step 2: Construct the Language Conversion Graph"></a>Step 2: Construct the Language Conversion Graph</h2><p>For each person, they can convert the languages they understand to the language they speak. This is equivalent to drawing a directed edge from the understood language to the spoken language. By traversing each person in this way, we can build a graph of language conversion.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">build_lang_graph</span>(people: &amp;<span class="type">Vec</span>&lt;Person&gt;, lang_dict: &amp;HashMap&lt;&amp;<span class="type">String</span>, <span class="type">usize</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">lang_graph</span>: <span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt; = <span class="built_in">vec!</span>[<span class="built_in">vec!</span>[]; lang_dict.<span class="title function_ invoke__">len</span>()];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">person</span> <span class="keyword">in</span> people &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">lang</span> <span class="keyword">in</span> person.understand.<span class="title function_ invoke__">borrow</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span> *lang == person.speak &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            lang_graph[lang_dict[lang]].<span class="title function_ invoke__">push</span>(lang_dict[&amp;person.speak]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..lang_graph.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">tmp</span>: HashSet&lt;_&gt; = lang_graph[i].<span class="title function_ invoke__">drain</span>(..).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">        lang_graph[i].<span class="title function_ invoke__">extend</span>(tmp.<span class="title function_ invoke__">into_iter</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    lang_graph</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The function’s end uses a <code>HashSet</code> for edge deduplication. Values in the array are placed into a <code>HashSet</code> and then back into the array to achieve deduplication.</p>
<h2 id="Step-3-Verify-Two-People-Can-Communicate"><a href="#Step-3-Verify-Two-People-Can-Communicate" class="headerlink" title="Step 3: Verify Two People Can Communicate"></a>Step 3: Verify Two People Can Communicate</h2><p>After the language graph is established, a function is needed to verify whether two people can understand each other’s spoken languages. If one person’s spoken language can be converted into one of the languages the other person understands, then it can be said that the second person can understand the first person’s speech, and vice versa. This is implemented using a naive DFS algorithm.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">test_connected_dfs</span>(</span><br><span class="line">    cur: <span class="type">usize</span>,</span><br><span class="line">    target: &amp;HashSet&lt;<span class="type">usize</span>&gt;,</span><br><span class="line">    lang_graph: &amp;<span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt;,</span><br><span class="line">    visited: &amp;<span class="keyword">mut</span> <span class="type">Vec</span>&lt;<span class="type">bool</span>&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> target.<span class="title function_ invoke__">contains</span>(&amp;cur) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    visited[cur] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">next</span> <span class="keyword">in</span> &amp;lang_graph[cur] &#123;</span><br><span class="line">        <span class="keyword">if</span> visited[*next] &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="title function_ invoke__">test_connected_dfs</span>(*next, target, lang_graph, visited) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">test_biconnected</span>(</span><br><span class="line">    a: &amp;Person,</span><br><span class="line">    b: &amp;Person,</span><br><span class="line">    lang_graph: &amp;<span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt;,</span><br><span class="line">    lang_dict: &amp;HashMap&lt;&amp;<span class="type">String</span>, <span class="type">usize</span>&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">visited</span> = <span class="built_in">vec!</span>[<span class="literal">false</span>; lang_graph.<span class="title function_ invoke__">len</span>()];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">target</span>: HashSet&lt;<span class="type">usize</span>&gt; = b</span><br><span class="line">        .understand</span><br><span class="line">        .<span class="title function_ invoke__">borrow</span>()</span><br><span class="line">        .<span class="title function_ invoke__">into_iter</span>()</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|s| lang_dict[s])</span><br><span class="line">        .<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="keyword">if</span> !<span class="title function_ invoke__">test_connected_dfs</span>(lang_dict[&amp;a.speak], &amp;target, lang_graph, &amp;<span class="keyword">mut</span> visited) &#123;</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    visited = <span class="built_in">vec!</span>[<span class="literal">false</span>; lang_graph.<span class="title function_ invoke__">len</span>()];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">target</span>: HashSet&lt;<span class="type">usize</span>&gt; = a</span><br><span class="line">        .understand</span><br><span class="line">        .<span class="title function_ invoke__">borrow</span>()</span><br><span class="line">        .<span class="title function_ invoke__">into_iter</span>()</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|s| lang_dict[s])</span><br><span class="line">        .<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="keyword">if</span> !<span class="title function_ invoke__">test_connected_dfs</span>(lang_dict[&amp;b.speak], &amp;target, lang_graph, &amp;<span class="keyword">mut</span> visited) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>test_biconnected</code> function encapsulates <code>test_connected_dfs</code>. By calling this subfunction twice, it verifies whether two people can communicate.</p>
<h2 id="Step-4-Construct-a-Disjoint-Set-Union"><a href="#Step-4-Construct-a-Disjoint-Set-Union" class="headerlink" title="Step 4: Construct a Disjoint Set Union"></a>Step 4: Construct a Disjoint Set Union</h2><p>When analyzing the relationships between each person, a disjoint set union (DSU) data structure is used for organization. Everyone in a DSU can communicate with each other, and if two people from different DSUs can communicate, those DSUs are merged.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">DisjointSetUnion</span> &#123;</span><br><span class="line">    fa: <span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">DisjointSetUnion</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_fa</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, cur: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.fa[cur] == cur &#123;</span><br><span class="line">            <span class="keyword">return</span> cur;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">tmp</span> = <span class="keyword">self</span>.fa[cur];</span><br><span class="line">        <span class="keyword">self</span>.fa[cur] = <span class="keyword">self</span>.<span class="title function_ invoke__">get_fa</span>(tmp);</span><br><span class="line">        <span class="keyword">self</span>.fa[cur]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">build_people_disjoint_set_union</span>(</span><br><span class="line">    people: &amp;<span class="type">Vec</span>&lt;Person&gt;,</span><br><span class="line">    lang_graph: &amp;<span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt;,</span><br><span class="line">    lang_dict: &amp;HashMap&lt;&amp;<span class="type">String</span>, <span class="type">usize</span>&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> DisjointSetUnion &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">people_disjoint_set_union</span> = DisjointSetUnion &#123;</span><br><span class="line">        fa: (<span class="number">0</span>..people.<span class="title function_ invoke__">len</span>()).<span class="title function_ invoke__">into_iter</span>().<span class="title function_ invoke__">collect</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..people.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">j</span> <span class="keyword">in</span> i + <span class="number">1</span>..people.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span> people_disjoint_set_union.<span class="title function_ invoke__">get_fa</span>(i) == people_disjoint_set_union.<span class="title function_ invoke__">get_fa</span>(j)</span><br><span class="line">                || !<span class="title function_ invoke__">test_biconnected</span>(&amp;people[i], &amp;people[j], lang_graph, lang_dict)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">tmp</span> = people_disjoint_set_union.<span class="title function_ invoke__">get_fa</span>(i);</span><br><span class="line">            people_disjoint_set_union.fa[tmp] = people_disjoint_set_union.<span class="title function_ invoke__">get_fa</span>(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    people_disjoint_set_union</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Path compression is used in the DSU implementation. Each call to <code>get_fa</code> updates the node’s parent to the root node of the set, thereby flattening the DSU and optimizing query efficiency.</p>
<h2 id="Step-5-Obtain-the-Largest-DSU-Count"><a href="#Step-5-Obtain-the-Largest-DSU-Count" class="headerlink" title="Step 5: Obtain the Largest DSU Count"></a>Step 5: Obtain the Largest DSU Count</h2><p>An array records the count of each DSU, and each node’s DSU is identified using <code>get_fa</code>, updating the count accordingly. The function returns the count of the largest DSU.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> <span class="title class_">DisjointSetUnion</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_fa</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, cur: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.fa[cur] == cur &#123;</span><br><span class="line">            <span class="keyword">return</span> cur;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">tmp</span> = <span class="keyword">self</span>.fa[cur];</span><br><span class="line">        <span class="keyword">self</span>.fa[cur] = <span class="keyword">self</span>.<span class="title function_ invoke__">get_fa</span>(tmp);</span><br><span class="line">        <span class="keyword">self</span>.fa[cur]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_largest_set</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num_of_set</span> = <span class="built_in">vec!</span>[<span class="number">0usize</span>; <span class="keyword">self</span>.fa.<span class="title function_ invoke__">len</span>()];</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="keyword">self</span>.fa.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">            num_of_set[<span class="keyword">self</span>.<span class="title function_ invoke__">get_fa</span>(i)] += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        *num_of_set.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">max</span>().<span class="title function_ invoke__">unwrap</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Step-6-Integrate-and-Return-the-Answer"><a href="#Step-6-Integrate-and-Return-the-Answer" class="headerlink" title="Step 6: Integrate and Return the Answer"></a>Step 6: Integrate and Return the Answer</h2><p>Arrange all subfunctions in the <code>main</code> function and print the value of <code>n - people_disjoint_set_union.get_largest_set()</code> as the result.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">n</span> = <span class="title function_ invoke__">read_line_of_i32</span>()[<span class="number">0</span>] <span class="keyword">as</span> <span class="type">usize</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">people</span> = <span class="title function_ invoke__">record_people</span>(n);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">lang_dict</span> = <span class="title function_ invoke__">build_language_dict</span>(&amp;people);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">lang_graph</span> = <span class="title function_ invoke__">build_lang_graph</span>(&amp;people, &amp;lang_dict);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">people_disjoint_set_union</span> =</span><br><span class="line">        <span class="title function_ invoke__">build_people_disjoint_set_union</span>(&amp;people, &amp;lang_graph, &amp;lang_dict);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, n - people_disjoint_set_union.<span class="title function_ invoke__">get_largest_set</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Conclusion-Complete-Code"><a href="#Conclusion-Complete-Code" class="headerlink" title="Conclusion: Complete Code"></a>Conclusion: Complete Code</h2><p>The provided code demonstrates a method for solving the problem by dividing people into sets based on language understanding and speaking, using data structures and algorithms such as hash maps, graphs, DFS, and disjoint set unions to efficiently find the minimum number of people that need to be excluded to allow for universal communication within the remaining group.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::&#123;</span><br><span class="line">    borrow::Borrow,</span><br><span class="line">    collections::&#123;HashMap, HashSet&#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    speak: <span class="type">String</span>,</span><br><span class="line">    understand: HashSet&lt;<span class="type">String</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">DisjointSetUnion</span> &#123;</span><br><span class="line">    fa: <span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">impl</span> <span class="title class_">DisjointSetUnion</span> &#123;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_fa</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, cur: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.fa[cur] == cur &#123;</span><br><span class="line">            <span class="keyword">return</span> cur;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">tmp</span> = <span class="keyword">self</span>.fa[cur];</span><br><span class="line">        <span class="keyword">self</span>.fa[cur] = <span class="keyword">self</span>.<span class="title function_ invoke__">get_fa</span>(tmp);</span><br><span class="line">        <span class="keyword">self</span>.fa[cur]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">get_largest_set</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) <span class="punctuation">-&gt;</span> <span class="type">usize</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num_of_set</span> = <span class="built_in">vec!</span>[<span class="number">0usize</span>; <span class="keyword">self</span>.fa.<span class="title function_ invoke__">len</span>()];</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..<span class="keyword">self</span>.fa.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">            num_of_set[<span class="keyword">self</span>.<span class="title function_ invoke__">get_fa</span>(i)] += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        *num_of_set.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">max</span>().<span class="title function_ invoke__">unwrap</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">n</span> = <span class="title function_ invoke__">read_line_of_i32</span>()[<span class="number">0</span>] <span class="keyword">as</span> <span class="type">usize</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">people</span> = <span class="title function_ invoke__">record_people</span>(n);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">lang_dict</span> = <span class="title function_ invoke__">build_language_dict</span>(&amp;people);</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">lang_graph</span> = <span class="title function_ invoke__">build_lang_graph</span>(&amp;people, &amp;lang_dict);</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">people_disjoint_set_union</span> =</span><br><span class="line">        <span class="title function_ invoke__">build_people_disjoint_set_union</span>(&amp;people, &amp;lang_graph, &amp;lang_dict);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, n - people_disjoint_set_union.<span class="title function_ invoke__">get_largest_set</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">build_people_disjoint_set_union</span>(</span><br><span class="line">    people: &amp;<span class="type">Vec</span>&lt;Person&gt;,</span><br><span class="line">    lang_graph: &amp;<span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt;,</span><br><span class="line">    lang_dict: &amp;HashMap&lt;&amp;<span class="type">String</span>, <span class="type">usize</span>&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> DisjointSetUnion &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">people_disjoint_set_union</span> = DisjointSetUnion &#123;</span><br><span class="line">        fa: (<span class="number">0</span>..people.<span class="title function_ invoke__">len</span>()).<span class="title function_ invoke__">into_iter</span>().<span class="title function_ invoke__">collect</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..people.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">j</span> <span class="keyword">in</span> i + <span class="number">1</span>..people.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span> people_disjoint_set_union.<span class="title function_ invoke__">get_fa</span>(i) == people_disjoint_set_union.<span class="title function_ invoke__">get_fa</span>(j)</span><br><span class="line">                || !<span class="title function_ invoke__">test_biconnected</span>(&amp;people[i], &amp;people[j], lang_graph, lang_dict)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">tmp</span> = people_disjoint_set_union.<span class="title function_ invoke__">get_fa</span>(i);</span><br><span class="line">            people_disjoint_set_union.fa[tmp] = people_disjoint_set_union.<span class="title function_ invoke__">get_fa</span>(j);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    people_disjoint_set_union</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">test_connected_dfs</span>(</span><br><span class="line">    cur: <span class="type">usize</span>,</span><br><span class="line">    target: &amp;HashSet&lt;<span class="type">usize</span>&gt;,</span><br><span class="line">    lang_graph: &amp;<span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt;,</span><br><span class="line">    visited: &amp;<span class="keyword">mut</span> <span class="type">Vec</span>&lt;<span class="type">bool</span>&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> target.<span class="title function_ invoke__">contains</span>(&amp;cur) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    visited[cur] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">next</span> <span class="keyword">in</span> &amp;lang_graph[cur] &#123;</span><br><span class="line">        <span class="keyword">if</span> visited[*next] &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="title function_ invoke__">test_connected_dfs</span>(*next, target, lang_graph, visited) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">test_biconnected</span>(</span><br><span class="line">    a: &amp;Person,</span><br><span class="line">    b: &amp;Person,</span><br><span class="line">    lang_graph: &amp;<span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt;,</span><br><span class="line">    lang_dict: &amp;HashMap&lt;&amp;<span class="type">String</span>, <span class="type">usize</span>&gt;,</span><br><span class="line">) <span class="punctuation">-&gt;</span> <span class="type">bool</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">visited</span> = <span class="built_in">vec!</span>[<span class="literal">false</span>; lang_graph.<span class="title function_ invoke__">len</span>()];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">target</span>: HashSet&lt;<span class="type">usize</span>&gt; = b</span><br><span class="line">        .understand</span><br><span class="line">        .<span class="title function_ invoke__">borrow</span>()</span><br><span class="line">        .<span class="title function_ invoke__">into_iter</span>()</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|s| lang_dict[s])</span><br><span class="line">        .<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="keyword">if</span> !<span class="title function_ invoke__">test_connected_dfs</span>(lang_dict[&amp;a.speak], &amp;target, lang_graph, &amp;<span class="keyword">mut</span> visited) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    visited = <span class="built_in">vec!</span>[<span class="literal">false</span>; lang_graph.<span class="title function_ invoke__">len</span>()];</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">target</span>: HashSet&lt;<span class="type">usize</span>&gt; = a</span><br><span class="line">        .understand</span><br><span class="line">        .<span class="title function_ invoke__">borrow</span>()</span><br><span class="line">        .<span class="title function_ invoke__">into_iter</span>()</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|s| lang_dict[s])</span><br><span class="line">        .<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    <span class="keyword">if</span> !<span class="title function_ invoke__">test_connected_dfs</span>(lang_dict[&amp;b.speak], &amp;target, lang_graph, &amp;<span class="keyword">mut</span> visited) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">build_lang_graph</span>(people: &amp;<span class="type">Vec</span>&lt;Person&gt;, lang_dict: &amp;HashMap&lt;&amp;<span class="type">String</span>, <span class="type">usize</span>&gt;) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">lang_graph</span>: <span class="type">Vec</span>&lt;<span class="type">Vec</span>&lt;<span class="type">usize</span>&gt;&gt; = <span class="built_in">vec!</span>[<span class="built_in">vec!</span>[]; lang_dict.<span class="title function_ invoke__">len</span>()];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">person</span> <span class="keyword">in</span> people &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">lang</span> <span class="keyword">in</span> person.understand.<span class="title function_ invoke__">borrow</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span> *lang == person.speak &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            lang_graph[lang_dict[lang]].<span class="title function_ invoke__">push</span>(lang_dict[&amp;person.speak]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">0</span>..lang_graph.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">tmp</span>: HashSet&lt;_&gt; = lang_graph[i].<span class="title function_ invoke__">drain</span>(..).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">        lang_graph[i].<span class="title function_ invoke__">extend</span>(tmp.<span class="title function_ invoke__">into_iter</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    lang_graph</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">build_language_dict</span>(people: &amp;<span class="type">Vec</span>&lt;Person&gt;) <span class="punctuation">-&gt;</span> HashMap&lt;&amp;<span class="type">String</span>, <span class="type">usize</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">lang_dict</span> = HashMap::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">num_of_lang</span> = <span class="number">0usize</span>;</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">person</span> <span class="keyword">in</span> people &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">lang</span> <span class="keyword">in</span> person.understand.<span class="title function_ invoke__">borrow</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span> lang_dict.<span class="title function_ invoke__">contains_key</span>(lang) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            lang_dict.<span class="title function_ invoke__">insert</span>(lang, num_of_lang);</span><br><span class="line">            num_of_lang += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    lang_dict</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">record_people</span>(n: <span class="type">usize</span>) <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;Person&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">people</span>: <span class="type">Vec</span>&lt;Person&gt; = <span class="built_in">vec!</span>[];</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">_</span> <span class="keyword">in</span> <span class="number">0</span>..n &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">input</span> = <span class="title function_ invoke__">read_line_of_string</span>();</span><br><span class="line">        <span class="comment">// println!(&quot;&#123;:?&#125;&quot;, input);</span></span><br><span class="line">        people.<span class="title function_ invoke__">push</span>(Person &#123;</span><br><span class="line">            speak: input[<span class="number">1</span>].<span class="title function_ invoke__">to_owned</span>(),</span><br><span class="line">            understand: HashSet::<span class="title function_ invoke__">new</span>(),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">id</span> = people.<span class="title function_ invoke__">len</span>() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..input.<span class="title function_ invoke__">len</span>() &#123;</span><br><span class="line">            people[id].understand.<span class="title function_ invoke__">insert</span>(input[i].<span class="title function_ invoke__">clone</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    people</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_line_of_i32</span>() <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">i32</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">buffer</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_</span> = std::io::<span class="title function_ invoke__">stdin</span>().<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> buffer);</span><br><span class="line">    buffer</span><br><span class="line">        .<span class="title function_ invoke__">trim</span>()</span><br><span class="line">        .<span class="title function_ invoke__">to_owned</span>()</span><br><span class="line">        .<span class="title function_ invoke__">split</span>(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|x| x.<span class="title function_ invoke__">to_owned</span>().parse::&lt;<span class="type">i32</span>&gt;().<span class="title function_ invoke__">unwrap</span>())</span><br><span class="line">        .<span class="title function_ invoke__">collect</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">read_line_of_string</span>() <span class="punctuation">-&gt;</span> <span class="type">Vec</span>&lt;<span class="type">String</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">buffer</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">_</span> = std::io::<span class="title function_ invoke__">stdin</span>().<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> buffer);</span><br><span class="line">    buffer</span><br><span class="line">        .<span class="title function_ invoke__">trim</span>()</span><br><span class="line">        .<span class="title function_ invoke__">to_owned</span>()</span><br><span class="line">        .<span class="title function_ invoke__">split</span>(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        .<span class="title function_ invoke__">map</span>(|x| x.<span class="title function_ invoke__">to_owned</span>())</span><br><span class="line">        .<span class="title function_ invoke__">collect</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://dawn-cmd.github.io/2024/02/02/First-Step-of-Dynamic-Programming-From-Fibonacci-to-Matrix-Acceleration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="HuaiYuan Jing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Developer Biography">
      <meta itemprop="description" content="history of blood and tear">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Developer Biography">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/02/First-Step-of-Dynamic-Programming-From-Fibonacci-to-Matrix-Acceleration/" class="post-title-link" itemprop="url">First Step of Dynamic Programming: From Fibonacci to Matrix Acceleration</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-02 17:24:37" itemprop="dateCreated datePublished" datetime="2024-02-02T17:24:37-06:00">2024-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-05 21:21:15" itemprop="dateModified" datetime="2024-02-05T21:21:15-06:00">2024-02-05</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Dynamic-Programming"><a href="#Dynamic-Programming" class="headerlink" title="Dynamic Programming"></a>Dynamic Programming</h2><blockquote>
<p>In both contexts it refers to simplifying a complicated problem by breaking it down into simpler sub-problems in a recursive manner. While some decision problems cannot be taken apart this way, decisions that span several points in time do often break apart recursively. Likewise, in computer science, if a problem can be solved optimally by breaking it into sub-problems and then recursively finding the optimal solutions to the sub-problems, then it is said to have optimal substructure.<br>If sub-problems can be nested recursively inside larger problems, so that dynamic programming methods are applicable, then there is a relation between the value of the larger problem and the values of the sub-problems. In the optimization literature this relationship is called the Bellman equation. –Wikipedia</p>
</blockquote>
<p>I’m not sure how much you understood from Wikipedia’s description, but I think starting with a simple example would be better.</p>
<h2 id="The-Fibonacci-Sequence-A-Gateway-to-Dynamic-Programming"><a href="#The-Fibonacci-Sequence-A-Gateway-to-Dynamic-Programming" class="headerlink" title="The Fibonacci Sequence: A Gateway to Dynamic Programming"></a>The Fibonacci Sequence: A Gateway to Dynamic Programming</h2><p>At its core, the Fibonacci sequence is a series of numbers where each number is the sum of the two preceding ones, starting from 0 and 1. Mathematically, it’s defined as:</p>
<p>$$<br>F_i &#x3D; F_{i-1} + F_{i-2} (i &gt;&#x3D; 2)\<br>F_1 &#x3D; 1, F_0 &#x3D; 0<br>$$</p>
<p>This simple formula lays the foundation for understanding the three pillars of dynamic programming: <strong>State</strong>, <strong>State Transition Equation</strong>, <strong>Boundary</strong></p>
<h3 id="State"><a href="#State" class="headerlink" title="State"></a>State</h3><p>In dynamic programming, the ‘state’ encapsulates the current situation in our problem-solving context. For the Fibonacci sequence, the state is represented by $F_i$, indicating the i-th number in the sequence. Understanding the state is crucial because it defines what we’re trying to compute.</p>
<h3 id="State-Transition-Equation"><a href="#State-Transition-Equation" class="headerlink" title="State Transition Equation"></a>State Transition Equation</h3><p>The state transition equation describes how to transition from one state to the next. For the Fibonacci sequence, this is given by $F_i &#x3D; F_{i-1} + F_{i-2}$. It shows how the current state (F_i) is derived from the previous two states ($F_{i-1}$ and $F_{i-2}$). This equation is the heart of dynamic programming, guiding how we break down problems into smaller, manageable pieces.</p>
<h3 id="Boundary"><a href="#Boundary" class="headerlink" title="Boundary"></a>Boundary</h3><p>Boundary conditions provide the starting points or base cases for our computation. For the Fibonacci sequence, these are $F_1$ &#x3D; 1 and $F_0$ &#x3D; 0. They’re essential because they prevent infinite recursion and ensure that our dynamic programming algorithm has a clear and definitive starting point.</p>
<p>Concepts end here. Let’s start to code.</p>
<h2 id="Implementation-of-Fibonacci-Sequence"><a href="#Implementation-of-Fibonacci-Sequence" class="headerlink" title="Implementation of Fibonacci Sequence"></a>Implementation of Fibonacci Sequence</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    fib = [<span class="number">0</span>] * (n + <span class="number">2</span>)</span><br><span class="line">    fib[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n + <span class="number">2</span>):</span><br><span class="line">        fib[i] = fib[i - <span class="number">1</span>] + fib[i - <span class="number">2</span>]</span><br><span class="line">    <span class="built_in">print</span>(fib[n])</span><br></pre></td></tr></table></figure>

<p>Here, we’ve crafted a function named <code>main</code> that computes the nth Fibonacci number. This function prompts for an input, <code>n</code>, and initializes an array <code>fib</code> with a length of <code>n + 2</code> (extra two is just for safety) to store the Fibonacci sequence. It sets the second element (index 1) to 1, reflecting the sequence’s start. Through a loop, it then calculates each Fibonacci number by summing the two preceding numbers and stores them in the array. Finally, it prints the nth Fibonacci number.</p>
<p>Let’s execute this function:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">35</span></span><br><span class="line"><span class="number">9227465</span></span><br><span class="line">Execution time: <span class="number">1.889999839477241e-05</span> seconds</span><br></pre></td></tr></table></figure>

<p>We’ve successfully solved our first dynamic programming problem with this implementation. However, the code can be streamlined for better readability. Let’s work on making it more intuitive.</p>
<h2 id="Implement-Fibonacci-Recursively"><a href="#Implement-Fibonacci-Recursively" class="headerlink" title="Implement Fibonacci Recursively"></a>Implement Fibonacci Recursively</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="keyword">return</span> i <span class="keyword">if</span> i &lt; <span class="number">2</span> <span class="keyword">else</span> fib(i - <span class="number">1</span>) + fib(i - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="built_in">print</span>(fib(n))  </span><br></pre></td></tr></table></figure>

<p>This recursive implementation is more intuitive and direct, using just a single line of code to define the Fibonacci computation. Let’s execute this function:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">35</span></span><br><span class="line"><span class="number">9227465</span></span><br><span class="line">The fib function took <span class="number">2.1213817596435547</span> seconds to execute.</span><br></pre></td></tr></table></figure>

<p>Okay, everything looks fine… Really?<br>Let’s see the third line of output.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The fib function took <span class="number">2.1213817596435547</span> seconds to execute.</span><br></pre></td></tr></table></figure>

<p>The function runs extremely slow. What happened there? Let’s check how many times does function fib() be called.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">35</span></span><br><span class="line"><span class="number">9227465</span></span><br><span class="line">The fib function took <span class="number">3.8617589473724365</span> seconds to execute.</span><br><span class="line">The fib function was called <span class="number">29860703</span> times.</span><br></pre></td></tr></table></figure>

<p>The observed slowdown in executing the recursive Fibonacci function, taking over 2 seconds to compute <code>fib(35)</code> and resulting in an astonishing <strong>29,860,703</strong> function calls, highlights a critical inefficiency inherent in the naive recursive approach. This inefficiency is primarily due to the excessive number of redundant calls for calculating the same Fibonacci numbers multiple times.</p>
<p>To understand why so many calls are made, consider how the recursive function works for <code>fib(n)</code>: it calls <code>fib(n-1)</code> and <code>fib(n-2)</code>. Both of these calls then recursively invoke further fib calculations, leading to a combinatorial explosion of function calls. Many of these calls are repeated; for instance, <code>fib(2)</code> is calculated multiple times across different branches of the recursion tree.</p>
<h2 id="Memorized-search"><a href="#Memorized-search" class="headerlink" title="Memorized search"></a>Memorized search</h2><p>Now let’s try to solve the problem. To address this inefficiency, a technique known as memoization can be applied. Memoization is a form of caching where the results of expensive function calls are stored, so that if the same inputs occur again, the function can return the stored result instead of recalculating it. Applying memoization to the Fibonacci sequence means that once we calculate <code>fib(n)</code>, we store its value. If fib(n) is needed again, we simply retrieve the stored value instead of recalculating it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cache = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="keyword">global</span> cache</span><br><span class="line">    <span class="keyword">if</span> cache[i] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> cache[i]</span><br><span class="line">    cache[i] = i <span class="keyword">if</span> i &lt; <span class="number">2</span> <span class="keyword">else</span> fib(i - <span class="number">1</span>) + fib(i - <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> cache[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">global</span> cache</span><br><span class="line">    n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    cache = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    result = fib(n)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>Let’s run and check the performance.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">35</span></span><br><span class="line"><span class="number">9227465</span></span><br><span class="line">The fib function took <span class="number">1.539999993838137e-05</span> seconds to execute.</span><br></pre></td></tr></table></figure>

<p>This performance boost is due to the drastic reduction in the number of calls to the fib function, as each Fibonacci number is calculated only once. Now it has the same runtime as the method use array. But can we make it better?</p>
<h2 id="Rolling-array"><a href="#Rolling-array" class="headerlink" title="Rolling array"></a>Rolling array</h2><p>Let’s revisit our initial dynamic programming approach to computing the nth Fibonacci number. In this version, we allocate an array large enough to hold all Fibonacci numbers up to n. However, we notice a key optimization point: to calculate any Fibonacci number, we only ever need the last two numbers in the sequence.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    fib = [<span class="number">0</span>] * (n + <span class="number">2</span>)</span><br><span class="line">    fib[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n + <span class="number">2</span>):</span><br><span class="line">        fib[i] = fib[i - <span class="number">1</span>] + fib[i - <span class="number">2</span>]</span><br><span class="line">    <span class="built_in">print</span>(fib[n])</span><br></pre></td></tr></table></figure>

<p>We can find that when we try to get n-th Fibonacci Number. It will create an array with n variables. But each time we only use <code>fib[i]</code>,<code>fib[i - 1]</code>, and <code>fib[i - 2]</code>. So we can track only these three variables.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    fib_i = <span class="number">1</span></span><br><span class="line">    fib_i_prev = <span class="number">0</span></span><br><span class="line">    start_time = time.perf_counter()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">        fib_i, fib_i_prev = fib_i + fib_i_prev, fib_i</span><br><span class="line">    end_time = time.perf_counter()</span><br><span class="line">    <span class="built_in">print</span>(fib_i)</span><br></pre></td></tr></table></figure>

<p>By maintaining just two variables, <code>fib_i</code> and <code>fib_i_prev</code>, and updating them in each iteration, we significantly reduce the space complexity of our program to <code>O(1)</code>, while still retaining a time complexity of <code>O(n)</code>. This rolling array technique optimizes our solution, making it both space-efficient and fast for calculating Fibonacci numbers. But what happened if it is still too slow.</p>
<h2 id="Matrix-Acceleration"><a href="#Matrix-Acceleration" class="headerlink" title="Matrix Acceleration"></a>Matrix Acceleration</h2><p>At first glance, achieving $O(1)$ space complexity and $O(n)$ time complexity might seem like the pinnacle of optimization for any algorithm. This might lead one to prematurely conclude that there’s no further scope for enhancement. However, this article aims to challenge that notion by introducing a mathematical strategy capable of significantly boosting our program’s efficiency, especially for large-scale problems.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">100000000</span></span><br><span class="line"><span class="number">908460138</span></span><br><span class="line">Execution time: <span class="number">10.320621700004267</span> seconds</span><br></pre></td></tr></table></figure>

<p>Consider when <code>n</code> scales to $10 ^ 8$. At this magnitude, an algorithm with $O(n)$ time complexity begins to show its limitations, as evidenced by an execution time exceeding 10 seconds. Such scenarios demand a more sophisticated approach to reduce the computational complexity further.</p>
<h2 id="Understanding-the-Fibonacci-Sequence-with-Matrix-Exponentiation"><a href="#Understanding-the-Fibonacci-Sequence-with-Matrix-Exponentiation" class="headerlink" title="Understanding the Fibonacci Sequence with Matrix Exponentiation"></a>Understanding the Fibonacci Sequence with Matrix Exponentiation</h2><p>The Fibonacci sequence is a classic example where exponential growth can cause simple recursive or iterative solutions to falter due to their linear or pseudo-linear time complexities. To compute the n-th Fibonacci number efficiently for very large n, we employ matrix exponentiation, a method that allows us to achieve a time complexity of $O(log_2{n})$.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">MOD = <span class="number">1000000007</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    n = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line">    <span class="built_in">print</span>(fib(n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    st = [[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]]</span><br><span class="line">    update_matrix = qpow([[<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]], n - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> matrix_multiply(st, update_matrix)[<span class="number">0</span>][<span class="number">0</span>] % MOD </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">qpow</span>(<span class="params">a, n</span>):</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> qpow(matrix_multiply(a, a), n // <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> matrix_multiply(a, qpow(matrix_multiply(a, a), n // <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">matrix_multiply</span>(<span class="params">a, b</span>):</span><br><span class="line">    ans = [[<span class="number">0</span>] * <span class="built_in">len</span>(b[<span class="number">0</span>]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a))]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b[<span class="number">0</span>])):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(b)): </span><br><span class="line">                ans[i][j] += a[i][k] * b[k][j] % MOD</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h3 id="Implementation-Details"><a href="#Implementation-Details" class="headerlink" title="Implementation Details"></a>Implementation Details</h3><p>The provided Python code showcases an efficient way to compute large Fibonacci numbers modulo MOD &#x3D; 1000000007, ensuring that the result stays within integer limits suitable for many computational environments.</p>
<ul>
<li><p>Matrix Power Quickening (qpow): The heart of this optimization lies in the qpow function, which implements fast exponentiation for matrices. Instead of naively multiplying the matrix n times, this function recursively squares the matrix, reducing the exponent by half each time, effectively turning the time complexity from $O(n)$ to $O(log_2{n})$.</p>
</li>
<li><p>Matrix Multiplication (matrix_multiply): This function multiplies two matrices, a crucial operation in our exponentiation process. Matrix multiplication is used both in the exponentiation process and in calculating the final Fibonacci number from the base case matrix.</p>
</li>
<li><p>Computing Fibonacci (fib): The fib function initializes a state matrix representing the base case of Fibonacci calculation. It then calculates the power of the transition matrix, which encodes the Fibonacci recurrence relation, using the optimized qpow method. The result is a matrix that, when multiplied by the state matrix, yields the n-th Fibonacci number.</p>
</li>
<li><p>Generalization: This method is not limited to Fibonacci numbers; it can be generalized to other problems that can be expressed in terms of matrix exponentiation, showcasing the versatility of the technique.</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://dawn-cmd.github.io/2023/07/25/An-Overview-of-a-Python-Script-for-Automated-Chat-Responses-using-OpenAI-s-GPT-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="HuaiYuan Jing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Developer Biography">
      <meta itemprop="description" content="history of blood and tear">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Developer Biography">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/07/25/An-Overview-of-a-Python-Script-for-Automated-Chat-Responses-using-OpenAI-s-GPT-3/" class="post-title-link" itemprop="url">An Overview of a Python Script for Automated Chat Responses using OpenAI's GPT-3</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-07-25 22:54:21" itemprop="dateCreated datePublished" datetime="2023-07-25T22:54:21-05:00">2023-07-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 17:07:28" itemprop="dateModified" datetime="2024-02-02T17:07:28-06:00">2024-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/applications/" itemprop="url" rel="index"><span itemprop="name">applications</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Abstraction"><a href="#Abstraction" class="headerlink" title="Abstraction"></a>Abstraction</h2><p>This Python project is designed to automate chat responses in the popular messaging application, WeChat (微信), using OpenAI’s GPT-3 model. The project leverages the power of GPT-3’s language understanding capabilities to generate contextually relevant responses to incoming messages.</p>
<h2 id="Project-Design"><a href="#Project-Design" class="headerlink" title="Project Design"></a>Project Design</h2><p>The project is structured around two main functions: the <code>GPT</code> function, which interacts with the GPT-3 model, and the <code>main</code> function, which handles the user interface and message processing in WeChat.</p>
<h3 id="GPT-Function"><a href="#GPT-Function" class="headerlink" title="GPT Function"></a>GPT Function</h3><p>The <code>GPT</code> function is designed to generate responses using the GPT-3 model. It takes as input a string <code>text</code> representing the incoming message and a list <code>record</code> that maintains the conversation history. The function appends the incoming message to the conversation record, sets the OpenAI API key, and creates a completion using the OpenAI API. The completion is a response generated by the GPT-3 model based on the conversation history. The function then extracts the assistant’s message from the response, appends it to the conversation record, and returns it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define a function to handle the interaction with the GPT-3 model</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GPT</span>(<span class="params">text: <span class="built_in">str</span>, record: <span class="type">List</span>[<span class="built_in">dict</span>]</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># Append the user&#x27;s message to the conversation record</span></span><br><span class="line">    record.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: text&#125;)</span><br><span class="line">    <span class="comment"># Print the user&#x27;s message for debugging purposes</span></span><br><span class="line">    <span class="built_in">print</span>(text)</span><br><span class="line">    <span class="comment"># Set the OpenAI API key</span></span><br><span class="line">    openai.api_key = apiKey</span><br><span class="line">    <span class="comment"># Define the model ID</span></span><br><span class="line">    <span class="built_in">id</span> = <span class="string">&quot;gpt-3.5-turbo&quot;</span></span><br><span class="line">    <span class="comment"># Initialize a question string with the user&#x27;s text</span></span><br><span class="line">    question = <span class="string">&quot;###&quot;</span> + text + <span class="string">&quot;###&quot;</span></span><br><span class="line">    <span class="comment"># Create a completion using the OpenAI API</span></span><br><span class="line">    response = openai.ChatCompletion.create(</span><br><span class="line">        model=<span class="built_in">id</span>,</span><br><span class="line">        messages=record,</span><br><span class="line">        temperature=<span class="number">0.1</span>,</span><br><span class="line">        top_p=<span class="number">0.1</span>,</span><br><span class="line">        max_tokens=<span class="number">2048</span>,</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># Extract the total token usage from the response for debugging purposes</span></span><br><span class="line">    usage = response.usage[<span class="string">&quot;total_tokens&quot;</span>]</span><br><span class="line">    <span class="comment"># Extract the content from the assistant&#x27;s message in the response</span></span><br><span class="line">    response = response[<span class="string">&quot;choices&quot;</span>][<span class="number">0</span>][<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>]</span><br><span class="line">    <span class="comment"># Append the assistant&#x27;s message to the conversation record</span></span><br><span class="line">    record.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: response&#125;)</span><br><span class="line">    <span class="comment"># Return the assistant&#x27;s response</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h3 id="Main-Function"><a href="#Main-Function" class="headerlink" title="Main Function"></a>Main Function</h3><p>The <code>main</code> function is the core of the project. It initializes the conversation with a user’s template and creates a <code>WindowControl</code> object for the WeChat window. It then creates a <code>ListControl</code> object for the chat list in the window and loads reply data from a CSV file.</p>
<p>The function then enters a loop where it continuously checks for unread messages in the chat. When an unread message is found, it clicks on it, extracts the content of the last message, and generates a reply using the <code>GPT</code> function. If the conversation record has more than six messages, it trims it down to maintain a manageable size. The function then prepares the reply to be sent. If there is a reply, it sends it; if there is no reply, it sends a default message.</p>
<p>The script is designed to handle exceptions gracefully. If an error occurs during the execution of the <code>main</code> function, it prints the error and breaks the loop.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># Initialize the conversation with the user&#x27;s template</span></span><br><span class="line">    mem = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: template&#125;]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Create a WindowControl object for the &quot;微信&quot; window</span></span><br><span class="line">        wx = WindowControl(Name=<span class="string">&quot;微信&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(wx)</span><br><span class="line">        wx.SwitchToThisWindow()</span><br><span class="line">        <span class="comment"># Create a ListControl object for the &quot;会话&quot; list in the window</span></span><br><span class="line">        chat = wx.ListControl(Name=<span class="string">&quot;会话&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Find chat and combine:&quot;</span>, chat)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Main loop</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Look for unread messages in the chat</span></span><br><span class="line">            unread = chat.TextControl(searchDepth=<span class="number">4</span>)</span><br><span class="line">            <span class="comment"># Wait until an unread message appears</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> unread.Exists(<span class="number">0</span>):</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Find unread:&quot;</span>, unread)</span><br><span class="line">            <span class="comment"># If there is an unread message, click on it</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> unread.Name: <span class="keyword">continue</span></span><br><span class="line">            unread.Click(simulateMove=<span class="literal">False</span>)</span><br><span class="line">            <span class="comment"># Extract the content of the last message</span></span><br><span class="line">            last_msg = wx.ListControl(Name=<span class="string">&quot;消息&quot;</span>).GetChildren()[-<span class="number">1</span>].Name</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Last message:&quot;</span>, last_msg)</span><br><span class="line">            <span class="comment"># Generate a reply using the GPT-3 model</span></span><br><span class="line">            reply = GPT(last_msg, mem)</span><br><span class="line">            <span class="comment"># If the conversation record has more than 6 messages, trim it down</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(mem) &gt; <span class="number">6</span>:</span><br><span class="line">                mem = mem[<span class="number">3</span>:]</span><br><span class="line">                mem = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: template&#125;] + mem</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;memory size:&quot;</span>, <span class="built_in">len</span>(mem))</span><br><span class="line">            <span class="comment"># Prepare the reply to be sent</span></span><br><span class="line">            ar = [reply]</span><br><span class="line">            <span class="comment"># If there is a reply, send it</span></span><br><span class="line">            <span class="keyword">if</span> ar:</span><br><span class="line">                wx.SwitchToThisWindow()</span><br><span class="line">                wx.SendKeys(ar[<span class="number">0</span>].replace(</span><br><span class="line">                    <span class="string">&quot;&#123;br&#125;&quot;</span>, <span class="string">&quot;&#123;Shift&#125;&#123;Enter&#125;&quot;</span>), waitTime=<span class="number">0</span>)</span><br><span class="line">                wx.SendKeys(<span class="string">&quot;&#123;Enter&#125;&quot;</span>, waitTime=<span class="number">0</span>)</span><br><span class="line">                wx.TextControl(SubName=ar[<span class="number">0</span>][:<span class="number">5</span>]).Click()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># If there is no reply, send a default message</span></span><br><span class="line">                wx.SwitchToThisWindow()</span><br><span class="line">                wx.SendKeys(<span class="string">&quot;Unknown&quot;</span>, waitTime=<span class="number">0</span>)</span><br><span class="line">                wx.SendKeys(<span class="string">&quot;&#123;Enter&#125;&quot;</span>, waitTime=<span class="number">0</span>)</span><br><span class="line">                wx.TextControl(SubName=last_msg[:<span class="number">5</span>]).Click()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h2><p>The script is designed to be run directly. If the script is run directly (i.e., not imported as a module), it calls the <code>main</code> function and starts the automated chat response process.</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In summary, this Python project is a sophisticated example of how to use OpenAI’s GPT-3 model to automate responses in a chat application. It demonstrates how to interact with the GPT-3 model, handle user interface elements in a chat application, and manage conversation history for context-aware responses. The project is a testament to the potential of AI in automating tasks and enhancing user experience in messaging platforms.</p>
<h2 id="Complete-Code"><a href="#Complete-Code" class="headerlink" title="Complete Code"></a>Complete Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> uiautomation <span class="keyword">import</span> WindowControl</span><br><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"></span><br><span class="line">apiKey = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">template = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a function to handle the interaction with the GPT-3 model</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GPT</span>(<span class="params">text: <span class="built_in">str</span>, record: <span class="type">List</span>[<span class="built_in">dict</span>]</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># Append the user&#x27;s message to the conversation record</span></span><br><span class="line">    record.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: text&#125;)</span><br><span class="line">    <span class="comment"># Print the user&#x27;s message for debugging purposes</span></span><br><span class="line">    <span class="built_in">print</span>(text)</span><br><span class="line">    <span class="comment"># Set the OpenAI API key</span></span><br><span class="line">    openai.api_key = apiKey</span><br><span class="line">    <span class="comment"># Define the model ID</span></span><br><span class="line">    <span class="built_in">id</span> = <span class="string">&quot;gpt-3.5-turbo&quot;</span></span><br><span class="line">    <span class="comment"># Initialize a question string with the user&#x27;s text</span></span><br><span class="line">    question = <span class="string">&quot;###&quot;</span> + text + <span class="string">&quot;###&quot;</span></span><br><span class="line">    <span class="comment"># Create a completion using the OpenAI API</span></span><br><span class="line">    response = openai.ChatCompletion.create(</span><br><span class="line">        model=<span class="built_in">id</span>,</span><br><span class="line">        messages=record,</span><br><span class="line">        temperature=<span class="number">0.1</span>,</span><br><span class="line">        top_p=<span class="number">0.1</span>,</span><br><span class="line">        max_tokens=<span class="number">2048</span>,</span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># Extract the total token usage from the response for debugging purposes</span></span><br><span class="line">    usage = response.usage[<span class="string">&quot;total_tokens&quot;</span>]</span><br><span class="line">    <span class="comment"># Extract the content from the assistant&#x27;s message in the response</span></span><br><span class="line">    response = response[<span class="string">&quot;choices&quot;</span>][<span class="number">0</span>][<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>]</span><br><span class="line">    <span class="comment"># Append the assistant&#x27;s message to the conversation record</span></span><br><span class="line">    record.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: response&#125;)</span><br><span class="line">    <span class="comment"># Return the assistant&#x27;s response</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Main function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># Initialize the conversation with the user&#x27;s template</span></span><br><span class="line">    mem = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: template&#125;]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Create a WindowControl object for the &quot;微信&quot; window</span></span><br><span class="line">        wx = WindowControl(Name=<span class="string">&quot;微信&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(wx)</span><br><span class="line">        wx.SwitchToThisWindow()</span><br><span class="line">        <span class="comment"># Create a ListControl object for the &quot;会话&quot; list in the window</span></span><br><span class="line">        chat = wx.ListControl(Name=<span class="string">&quot;会话&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Find chat and combine:&quot;</span>, chat)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Main loop</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Look for unread messages in the chat</span></span><br><span class="line">            unread = chat.TextControl(searchDepth=<span class="number">4</span>)</span><br><span class="line">            <span class="comment"># Wait until an unread message appears</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> unread.Exists(<span class="number">0</span>):</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Find unread:&quot;</span>, unread)</span><br><span class="line">            <span class="comment"># If there is an unread message, click on it</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> unread.Name: <span class="keyword">continue</span></span><br><span class="line">            unread.Click(simulateMove=<span class="literal">False</span>)</span><br><span class="line">            <span class="comment"># Extract the content of the last message</span></span><br><span class="line">            last_msg = wx.ListControl(Name=<span class="string">&quot;消息&quot;</span>).GetChildren()[-<span class="number">1</span>].Name</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Last message:&quot;</span>, last_msg)</span><br><span class="line">            <span class="comment"># Generate a reply using the GPT-3 model</span></span><br><span class="line">            reply = GPT(last_msg, mem)</span><br><span class="line">            <span class="comment"># If the conversation record has more than 6 messages, trim it down</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(mem) &gt; <span class="number">6</span>:</span><br><span class="line">                mem = mem[<span class="number">3</span>:]</span><br><span class="line">                mem = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: template&#125;] + mem</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;memory size:&quot;</span>, <span class="built_in">len</span>(mem))</span><br><span class="line">            <span class="comment"># Prepare the reply to be sent</span></span><br><span class="line">            ar = [reply]</span><br><span class="line">            <span class="comment"># If there is a reply, send it</span></span><br><span class="line">            <span class="keyword">if</span> ar:</span><br><span class="line">                wx.SwitchToThisWindow()</span><br><span class="line">                wx.SendKeys(ar[<span class="number">0</span>].replace(</span><br><span class="line">                    <span class="string">&quot;&#123;br&#125;&quot;</span>, <span class="string">&quot;&#123;Shift&#125;&#123;Enter&#125;&quot;</span>), waitTime=<span class="number">0</span>)</span><br><span class="line">                wx.SendKeys(<span class="string">&quot;&#123;Enter&#125;&quot;</span>, waitTime=<span class="number">0</span>)</span><br><span class="line">                wx.TextControl(SubName=ar[<span class="number">0</span>][:<span class="number">5</span>]).Click()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># If there is no reply, send a default message</span></span><br><span class="line">                wx.SwitchToThisWindow()</span><br><span class="line">                wx.SendKeys(<span class="string">&quot;Unknown&quot;</span>, waitTime=<span class="number">0</span>)</span><br><span class="line">                wx.SendKeys(<span class="string">&quot;&#123;Enter&#125;&quot;</span>, waitTime=<span class="number">0</span>)</span><br><span class="line">                wx.TextControl(SubName=last_msg[:<span class="number">5</span>]).Click()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the main function if this script is run directly</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://dawn-cmd.github.io/2023/03/24/A-Multifaceted-Translation-Tool-Integrating-GPT-3-5-Turbo-and-Wox-for-Seamless-Language-Processing-zh-CN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="HuaiYuan Jing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Developer Biography">
      <meta itemprop="description" content="history of blood and tear">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Developer Biography">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/24/A-Multifaceted-Translation-Tool-Integrating-GPT-3-5-Turbo-and-Wox-for-Seamless-Language-Processing-zh-CN/" class="post-title-link" itemprop="url">A Multifaceted Translation Tool: Integrating GPT-3.5 Turbo and Wox for Seamless Language Processing(zh-CN)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-03-24 16:51:14" itemprop="dateCreated datePublished" datetime="2023-03-24T16:51:14-05:00">2023-03-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 17:07:00" itemprop="dateModified" datetime="2024-02-02T17:07:00-06:00">2024-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/applications/" itemprop="url" rel="index"><span itemprop="name">applications</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a href="https://dawn-cmd.github.io/2023/03/24/A-Multifaceted-Translation-Tool-Integrating-GPT-3-5-Turbo-and-Wox-for-Seamless-Language-Processing/">English Version</a></p>
<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>本文介绍了一种功能强大的翻译工具，将 OpenAI 的先进 GPT-3.5 Turbo 语言模型与用户友好的 Wox 启动器插件系统相结合。该工具可以识别输入文本的语言，将中文文本翻译成英文或将英文文本翻译成中文，并用中文提供解释和示例。本文阐述了核心功能，与 Wox 启动器的交互以及使用 pyperclip 库实现的剪贴板集成。我们还提供了一段代码示例，以演示其实现。</p>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在本文中，我们介绍了一种功能强大的翻译工具，将 OpenAI 的尖端 GPT-3.5 Turbo 语言模型与用户友好的 Wox 启动器插件系统相结合。该工具旨在识别输入文本的语言，将中文文本翻译成英文或其他语言的文本翻译成中文，并提供中文解释和示例。</p>
<h2 id="利用-GPT-3-5-Turbo"><a href="#利用-GPT-3-5-Turbo" class="headerlink" title="利用 GPT-3.5 Turbo"></a>利用 GPT-3.5 Turbo</h2><p>OpenAI 的 GPT-3.5 Turbo 语言模型以高效处理复杂语言任务而闻名。该翻译工具利用模型的功能，通过实现一个翻译函数来接收文本输入，构建一个格式化的问题发送给模型，并接收响应。然后解析响应，提取相关信息并将其作为列表返回。您可以在此处获取有关 ChatAPI 的更多信息：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://platform.openai.com/docs/api-reference">openAI 文档</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">translate</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">    openai.api_key = KEY</span><br><span class="line">    <span class="built_in">id</span> = <span class="string">&quot;gpt-3.5-turbo&quot;</span></span><br><span class="line">    question = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1: Check the text&#x27;s language</span></span><br><span class="line"><span class="string">2:  If language != Chinese &#123;</span></span><br><span class="line"><span class="string">        translate it into Chinese </span></span><br><span class="line"><span class="string">    &#125; else &#123;</span></span><br><span class="line"><span class="string">        translate it into English</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">3: Desired format:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">language: -||-</span></span><br><span class="line"><span class="string">translate: -||-</span></span><br><span class="line"><span class="string">explanation: -||-</span></span><br><span class="line"><span class="string">example: -||-</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text1: ###Hello###</span></span><br><span class="line"><span class="string">language: English</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: Hello, how are you today?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text2: ###你好###</span></span><br><span class="line"><span class="string">language: Chinese</span></span><br><span class="line"><span class="string">translate: Hello</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: 你好，你今天怎么样?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text3: ###こんにちは###</span></span><br><span class="line"><span class="string">language: Japanese</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: こんにちは、今日はお元気ですか?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text4: ###안녕하세요###</span></span><br><span class="line"><span class="string">language: Korean</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: 안녕하세요, 오늘은 어떻게 지내세요?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text5: &quot;&quot;&quot;</span></span><br><span class="line">    question += <span class="string">&quot;###&quot;</span> + text + <span class="string">&quot;###&quot;</span></span><br><span class="line">    response = openai.ChatCompletion.create(</span><br><span class="line">        model=<span class="built_in">id</span>,</span><br><span class="line">        messages=[&#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: question</span><br><span class="line">        &#125;],</span><br><span class="line">        temperature=<span class="number">0</span>,</span><br><span class="line">        top_p=<span class="number">0.1</span>,</span><br><span class="line">        max_tokens=<span class="number">2048</span>,</span><br><span class="line">    )</span><br><span class="line">    usage = response.usage[<span class="string">&quot;total_tokens&quot;</span>]</span><br><span class="line">    response = response[<span class="string">&quot;choices&quot;</span>][<span class="number">0</span>][<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>]</span><br><span class="line">    <span class="comment"># print(response)</span></span><br><span class="line">    response = <span class="built_in">list</span>(response.split(<span class="string">&quot;\n&quot;</span>))</span><br><span class="line">    response.append(<span class="string">&quot;usage: &quot;</span> + <span class="built_in">str</span>(usage))</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h2 id="与-Wox-启动器集成"><a href="#与-Wox-启动器集成" class="headerlink" title="与 Wox 启动器集成"></a>与 Wox 启动器集成</h2><p>Wox 启动器插件系统为用户提供了一个方便的互动的界面来使用翻译工具。通过创建一个继承自 Wox 类的主类，该工具定义了一个查询方法来处理用户输入并显示结果。当用户输入一个以 “&amp;” 结尾的关键字时，代码调用翻译函数，将响应显示为可选择的项目列表。您可以在此处获取有关 Wox 启动器插件开发的更多信息：<a target="_blank" rel="external nofollow noopener noreferrer" href="http://doc.wox.one/">Wox 文档</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">main</span>(<span class="title class_ inherited__">Wox</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query</span>(<span class="params">self, keyword: <span class="built_in">str</span></span>):</span><br><span class="line">        results = []</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> keyword.endswith(<span class="string">&#x27;&amp;&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line">        response: <span class="built_in">list</span>[<span class="built_in">str</span>] = translate(keyword[:-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> reponse <span class="keyword">in</span> response:</span><br><span class="line">            results.append(&#123;</span><br><span class="line">                <span class="string">&quot;IcoPath&quot;</span>: <span class="string">&quot;Images/ico.png&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Title&quot;</span>: reponse,</span><br><span class="line">                <span class="string">&quot;SubTitle&quot;</span>: <span class="string">&quot;Copy&quot;</span>,</span><br><span class="line">                <span class="string">&quot;JsonRPCAction&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;method&quot;</span>: <span class="string">&quot;copy&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;parameters&quot;</span>: [reponse],</span><br><span class="line">                    <span class="string">&quot;dontHideAfterAction&quot;</span>: <span class="literal">False</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">copy</span>(<span class="params">self, word: <span class="built_in">str</span></span>):</span><br><span class="line">        pyperclip.copy(word)</span><br></pre></td></tr></table></figure>

<h2 id="集成剪贴板"><a href="#集成剪贴板" class="headerlink" title="集成剪贴板"></a>集成剪贴板</h2><p>为了提高用户体验，脚本集成了 pyperclip 库，使用户只需点击即可将所选文本复制到剪贴板。在选择结果时，触发复制方法，轻松为用户复制文本以便粘贴到其他应用程序中。</p>
<h2 id="显示"><a href="#显示" class="headerlink" title="显示"></a>显示</h2><p><img data-src="https://drive.google.com/uc?export=view&id=1MsxBqOFNjsUQT37eFcdn9uUKIt_mwuJl" alt="Display"></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">from</span> wox <span class="keyword">import</span> Wox</span><br><span class="line"><span class="keyword">import</span> pyperclip</span><br><span class="line"></span><br><span class="line">KEY = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">translate</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">    openai.api_key = KEY</span><br><span class="line">    <span class="built_in">id</span> = <span class="string">&quot;gpt-3.5-turbo&quot;</span></span><br><span class="line">    question = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1: Check the text&#x27;s language</span></span><br><span class="line"><span class="string">2:  If language != Chinese &#123;</span></span><br><span class="line"><span class="string">        translate it into Chinese </span></span><br><span class="line"><span class="string">    &#125; else &#123;</span></span><br><span class="line"><span class="string">        translate it into English</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">3: Desired format:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">language: -||-</span></span><br><span class="line"><span class="string">translate: -||-</span></span><br><span class="line"><span class="string">explanation: -||-</span></span><br><span class="line"><span class="string">example: -||-</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text1: ###Hello###</span></span><br><span class="line"><span class="string">language: English</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: Hello, how are you today?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text2: ###你好###</span></span><br><span class="line"><span class="string">language: Chinese</span></span><br><span class="line"><span class="string">translate: Hello</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: 你好，你今天怎么样?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text3: ###こんにちは###</span></span><br><span class="line"><span class="string">language: Japanese</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: こんにちは、今日はお元気ですか?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text4: ###안녕하세요###</span></span><br><span class="line"><span class="string">language: Korean</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: 안녕하세요, 오늘은 어떻게 지내세요?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text5: &quot;&quot;&quot;</span></span><br><span class="line">    question += <span class="string">&quot;###&quot;</span> + text + <span class="string">&quot;###&quot;</span></span><br><span class="line">    response = openai.ChatCompletion.create(</span><br><span class="line">        model=<span class="built_in">id</span>,</span><br><span class="line">        messages=[&#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: question</span><br><span class="line">        &#125;],</span><br><span class="line">        temperature=<span class="number">0</span>,</span><br><span class="line">        top_p=<span class="number">0.1</span>,</span><br><span class="line">        max_tokens=<span class="number">2048</span>,</span><br><span class="line">    )</span><br><span class="line">    usage = response.usage[<span class="string">&quot;total_tokens&quot;</span>]</span><br><span class="line">    response = response[<span class="string">&quot;choices&quot;</span>][<span class="number">0</span>][<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>]</span><br><span class="line">    <span class="comment"># print(response)</span></span><br><span class="line">    response = <span class="built_in">list</span>(response.split(<span class="string">&quot;\n&quot;</span>))</span><br><span class="line">    response.append(<span class="string">&quot;usage: &quot;</span> + <span class="built_in">str</span>(usage))</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">main</span>(<span class="title class_ inherited__">Wox</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query</span>(<span class="params">self, keyword: <span class="built_in">str</span></span>):</span><br><span class="line">        results = []</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> keyword.endswith(<span class="string">&#x27;&amp;&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line">        response: <span class="built_in">list</span>[<span class="built_in">str</span>] = translate(keyword[:-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> reponse <span class="keyword">in</span> response:</span><br><span class="line">            results.append(&#123;</span><br><span class="line">                <span class="string">&quot;IcoPath&quot;</span>: <span class="string">&quot;Images/ico.png&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Title&quot;</span>: reponse,</span><br><span class="line">                <span class="string">&quot;SubTitle&quot;</span>: <span class="string">&quot;Copy&quot;</span>,</span><br><span class="line">                <span class="string">&quot;JsonRPCAction&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;method&quot;</span>: <span class="string">&quot;copy&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;parameters&quot;</span>: [reponse],</span><br><span class="line">                    <span class="string">&quot;dontHideAfterAction&quot;</span>: <span class="literal">False</span>      <span class="comment"># 运行后是否隐藏Wox窗口</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">copy</span>(<span class="params">self, word: <span class="built_in">str</span></span>):</span><br><span class="line">        pyperclip.copy(word)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://dawn-cmd.github.io/2023/03/24/A-Multifaceted-Translation-Tool-Integrating-GPT-3-5-Turbo-and-Wox-for-Seamless-Language-Processing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="HuaiYuan Jing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Developer Biography">
      <meta itemprop="description" content="history of blood and tear">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Developer Biography">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/24/A-Multifaceted-Translation-Tool-Integrating-GPT-3-5-Turbo-and-Wox-for-Seamless-Language-Processing/" class="post-title-link" itemprop="url">A Multifaceted Translation Tool: Integrating GPT-3.5 Turbo and Wox for Seamless Language Processing</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-03-24 16:26:55" itemprop="dateCreated datePublished" datetime="2023-03-24T16:26:55-05:00">2023-03-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 17:07:16" itemprop="dateModified" datetime="2024-02-02T17:07:16-06:00">2024-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/applications/" itemprop="url" rel="index"><span itemprop="name">applications</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a href="https://dawn-cmd.github.io/2023/03/24/A-Multifaceted-Translation-Tool-Integrating-GPT-3-5-Turbo-and-Wox-for-Seamless-Language-Processing-zh-CN/">中文版</a></p>
<h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>This article presents a powerful translation tool that combines the advanced GPT-3.5 Turbo language model by OpenAI with the user-friendly Wox launcher plugin system. The tool identifies the input text’s language, translates Chinese text to English or English text to Chinese, and provides an explanation and example in Chinese. The article explains the core functionality, interaction with Wox launcher, and clipboard integration using the pyperclip library. We also provide an example of the code to demonstrate its implementation.</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>In this article, we introduce a powerful translation tool that integrates the cutting-edge GPT-3.5 Turbo language model by OpenAI with the user-friendly Wox launcher plugin system. This tool is designed to identify the input text’s language, translate Chinese text to English or other languages’ text to Chinese, and provide an explanation and an example in Chinese.</p>
<h2 id="Harnessing-GPT-3-5-Turbo"><a href="#Harnessing-GPT-3-5-Turbo" class="headerlink" title="Harnessing GPT-3.5 Turbo"></a>Harnessing GPT-3.5 Turbo</h2><p>The GPT-3.5 Turbo language model by OpenAI is known for its ability to handle complex language tasks efficiently. This translation tool utilizes the model’s capabilities by implementing a translate function that takes a text input, constructs a formatted question to send to the model, and receives a response. The response is then parsed, extracting the relevant information and returning it as a list. You can get more information about ChatAPI here: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://platform.openai.com/docs/api-reference">openAI documentation</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">translate</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">    openai.api_key = KEY</span><br><span class="line">    <span class="built_in">id</span> = <span class="string">&quot;gpt-3.5-turbo&quot;</span></span><br><span class="line">    question = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1: Check the text&#x27;s language</span></span><br><span class="line"><span class="string">2:  If language != Chinese &#123;</span></span><br><span class="line"><span class="string">        translate it into Chinese </span></span><br><span class="line"><span class="string">    &#125; else &#123;</span></span><br><span class="line"><span class="string">        translate it into English</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">3: Desired format:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">language: -||-</span></span><br><span class="line"><span class="string">translate: -||-</span></span><br><span class="line"><span class="string">explanation: -||-</span></span><br><span class="line"><span class="string">example: -||-</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text1: ###Hello###</span></span><br><span class="line"><span class="string">language: English</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: Hello, how are you today?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text2: ###你好###</span></span><br><span class="line"><span class="string">language: Chinese</span></span><br><span class="line"><span class="string">translate: Hello</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: 你好，你今天怎么样?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text3: ###こんにちは###</span></span><br><span class="line"><span class="string">language: Japanese</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: こんにちは、今日はお元気ですか?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text4: ###안녕하세요###</span></span><br><span class="line"><span class="string">language: Korean</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: 안녕하세요, 오늘은 어떻게 지내세요?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text5: &quot;&quot;&quot;</span></span><br><span class="line">    question += <span class="string">&quot;###&quot;</span> + text + <span class="string">&quot;###&quot;</span></span><br><span class="line">    response = openai.ChatCompletion.create(</span><br><span class="line">        model=<span class="built_in">id</span>,</span><br><span class="line">        messages=[&#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: question</span><br><span class="line">        &#125;],</span><br><span class="line">        temperature=<span class="number">0</span>,</span><br><span class="line">        top_p=<span class="number">0.1</span>,</span><br><span class="line">        max_tokens=<span class="number">2048</span>,</span><br><span class="line">    )</span><br><span class="line">    usage = response.usage[<span class="string">&quot;total_tokens&quot;</span>]</span><br><span class="line">    response = response[<span class="string">&quot;choices&quot;</span>][<span class="number">0</span>][<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>]</span><br><span class="line">    <span class="comment"># print(response)</span></span><br><span class="line">    response = <span class="built_in">list</span>(response.split(<span class="string">&quot;\n&quot;</span>))</span><br><span class="line">    response.append(<span class="string">&quot;usage: &quot;</span> + <span class="built_in">str</span>(usage))</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>

<h2 id="Integrating-with-Wox-Launcher"><a href="#Integrating-with-Wox-Launcher" class="headerlink" title="Integrating with Wox Launcher"></a>Integrating with Wox Launcher</h2><p>The Wox launcher plugin system offers a convenient and interactive interface for users to engage with the translation tool. By creating a main class that inherits from the Wox class, the tool defines a query method to handle user input and display results. When a user enters a keyword ending with an ampersand (&amp;), the code calls the translate function, displaying the response as a list of selectable items. You can get more information about the Wox launcher plugin development here:  <a target="_blank" rel="external nofollow noopener noreferrer" href="http://doc.wox.one/">Wox Documentation</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">main</span>(<span class="title class_ inherited__">Wox</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query</span>(<span class="params">self, keyword: <span class="built_in">str</span></span>):</span><br><span class="line">        results = []</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> keyword.endswith(<span class="string">&#x27;&amp;&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line">        response: <span class="built_in">list</span>[<span class="built_in">str</span>] = translate(keyword[:-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> reponse <span class="keyword">in</span> response:</span><br><span class="line">            results.append(&#123;</span><br><span class="line">                <span class="string">&quot;IcoPath&quot;</span>: <span class="string">&quot;Images/ico.png&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Title&quot;</span>: reponse,</span><br><span class="line">                <span class="string">&quot;SubTitle&quot;</span>: <span class="string">&quot;Copy&quot;</span>,</span><br><span class="line">                <span class="string">&quot;JsonRPCAction&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;method&quot;</span>: <span class="string">&quot;copy&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;parameters&quot;</span>: [reponse],</span><br><span class="line">                    <span class="string">&quot;dontHideAfterAction&quot;</span>: <span class="literal">False</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">copy</span>(<span class="params">self, word: <span class="built_in">str</span></span>):</span><br><span class="line">        pyperclip.copy(word)</span><br></pre></td></tr></table></figure>

<h2 id="Clipboard-Integration-for-User-Convenience"><a href="#Clipboard-Integration-for-User-Convenience" class="headerlink" title="Clipboard Integration for User Convenience"></a>Clipboard Integration for User Convenience</h2><p>To enhance user experience, the script incorporates the pyperclip library, enabling users to copy the selected text to the clipboard with just a click. Upon selecting a result, the copy method is triggered, effortlessly copying the text for users to paste into other applications.</p>
<h2 id="Display"><a href="#Display" class="headerlink" title="Display"></a>Display</h2><p><img data-src="https://drive.google.com/uc?export=view&id=1MsxBqOFNjsUQT37eFcdn9uUKIt_mwuJl" alt="Display"></p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openai</span><br><span class="line"><span class="keyword">from</span> wox <span class="keyword">import</span> Wox</span><br><span class="line"><span class="keyword">import</span> pyperclip</span><br><span class="line"></span><br><span class="line">KEY = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">translate</span>(<span class="params">text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>:</span><br><span class="line">    openai.api_key = KEY</span><br><span class="line">    <span class="built_in">id</span> = <span class="string">&quot;gpt-3.5-turbo&quot;</span></span><br><span class="line">    question = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1: Check the text&#x27;s language</span></span><br><span class="line"><span class="string">2:  If language != Chinese &#123;</span></span><br><span class="line"><span class="string">        translate it into Chinese </span></span><br><span class="line"><span class="string">    &#125; else &#123;</span></span><br><span class="line"><span class="string">        translate it into English</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">3: Desired format:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">language: -||-</span></span><br><span class="line"><span class="string">translate: -||-</span></span><br><span class="line"><span class="string">explanation: -||-</span></span><br><span class="line"><span class="string">example: -||-</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text1: ###Hello###</span></span><br><span class="line"><span class="string">language: English</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: Hello, how are you today?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text2: ###你好###</span></span><br><span class="line"><span class="string">language: Chinese</span></span><br><span class="line"><span class="string">translate: Hello</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: 你好，你今天怎么样?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text3: ###こんにちは###</span></span><br><span class="line"><span class="string">language: Japanese</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: こんにちは、今日はお元気ですか?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text4: ###안녕하세요###</span></span><br><span class="line"><span class="string">language: Korean</span></span><br><span class="line"><span class="string">translate: 你好</span></span><br><span class="line"><span class="string">explanation: 这是常用的问候语</span></span><br><span class="line"><span class="string">example: 안녕하세요, 오늘은 어떻게 지내세요?</span></span><br><span class="line"><span class="string">##</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Text5: &quot;&quot;&quot;</span></span><br><span class="line">    question += <span class="string">&quot;###&quot;</span> + text + <span class="string">&quot;###&quot;</span></span><br><span class="line">    response = openai.ChatCompletion.create(</span><br><span class="line">        model=<span class="built_in">id</span>,</span><br><span class="line">        messages=[&#123;</span><br><span class="line">            <span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>: question</span><br><span class="line">        &#125;],</span><br><span class="line">        temperature=<span class="number">0</span>,</span><br><span class="line">        top_p=<span class="number">0.1</span>,</span><br><span class="line">        max_tokens=<span class="number">2048</span>,</span><br><span class="line">    )</span><br><span class="line">    usage = response.usage[<span class="string">&quot;total_tokens&quot;</span>]</span><br><span class="line">    response = response[<span class="string">&quot;choices&quot;</span>][<span class="number">0</span>][<span class="string">&quot;message&quot;</span>][<span class="string">&quot;content&quot;</span>]</span><br><span class="line">    <span class="comment"># print(response)</span></span><br><span class="line">    response = <span class="built_in">list</span>(response.split(<span class="string">&quot;\n&quot;</span>))</span><br><span class="line">    response.append(<span class="string">&quot;usage: &quot;</span> + <span class="built_in">str</span>(usage))</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">main</span>(<span class="title class_ inherited__">Wox</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query</span>(<span class="params">self, keyword: <span class="built_in">str</span></span>):</span><br><span class="line">        results = []</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> keyword.endswith(<span class="string">&#x27;&amp;&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line">        response: <span class="built_in">list</span>[<span class="built_in">str</span>] = translate(keyword[:-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">for</span> reponse <span class="keyword">in</span> response:</span><br><span class="line">            results.append(&#123;</span><br><span class="line">                <span class="string">&quot;IcoPath&quot;</span>: <span class="string">&quot;Images/ico.png&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Title&quot;</span>: reponse,</span><br><span class="line">                <span class="string">&quot;SubTitle&quot;</span>: <span class="string">&quot;Copy&quot;</span>,</span><br><span class="line">                <span class="string">&quot;JsonRPCAction&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;method&quot;</span>: <span class="string">&quot;copy&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;parameters&quot;</span>: [reponse],</span><br><span class="line">                    <span class="string">&quot;dontHideAfterAction&quot;</span>: <span class="literal">False</span>      <span class="comment"># 运行后是否隐藏Wox窗口</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">copy</span>(<span class="params">self, word: <span class="built_in">str</span></span>):</span><br><span class="line">        pyperclip.copy(word)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://dawn-cmd.github.io/2023/03/21/Red-Black-Tree-zh-CN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="HuaiYuan Jing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Developer Biography">
      <meta itemprop="description" content="history of blood and tear">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Developer Biography">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/03/21/Red-Black-Tree-zh-CN/" class="post-title-link" itemprop="url">Red-Black-Tree(zh-CN)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-03-21 11:40:46" itemprop="dateCreated datePublished" datetime="2023-03-21T11:40:46-05:00">2023-03-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 17:06:09" itemprop="dateModified" datetime="2024-02-02T17:06:09-06:00">2024-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/data-structure-algorithm/" itemprop="url" rel="index"><span itemprop="name">data structure & algorithm</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a href="https://dawn-cmd.github.io/2023/02/22/Red-Black-Tree/">English Version</a></p>
<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>红黑树是一种自平衡的二叉搜索树，用于按排序顺序存储和检索元素，并具有O（log n）时间复杂度的所有主要操作。它们被设计为内存高效和平衡，使它们比其他平衡树如AVL树更高效。在本文中，我们讨论了在Rust中实现红黑树，这是一种为性能和安全性而设计的现代编程语言。我们讨论了树的结构，以及插入，删除和搜索的函数。此外，我们还讨论了修复函数，用于在每次插入和删除后恢复树的高度平衡和颜色平衡属性。最后，我们讨论了左旋和右旋函数，用于维护红黑树的平衡属性。通过使用Rust来实现红黑树，我们可以利用该语言的性能和安全性功能来创建高效且可靠的数据结构。</p>
<h2 id="什么是红黑树（RBT）？"><a href="#什么是红黑树（RBT）？" class="headerlink" title="什么是红黑树（RBT）？"></a>什么是红黑树（RBT）？</h2><p>红黑树是一种二叉搜索树，其中每个节点都被着色为红色或黑色。节点的颜色用于平衡树，以使从根节点到任何叶子节点的最长路径不超过从根节点到任何其他叶子节点的最短路径的两倍。此属性称为高度平衡属性。</p>
<h2 id="红黑树是按照以下规则构建的"><a href="#红黑树是按照以下规则构建的" class="headerlink" title="红黑树是按照以下规则构建的"></a>红黑树是按照以下规则构建的</h2><ol>
<li>每个节点都是红色或黑色。</li>
<li>根节点始终为黑色。</li>
<li>每个叶子（NIL）节点都是黑色的。</li>
<li>如果一个节点为红色，则它的两个子节点必须为黑色。</li>
<li>从给定节点到其任何后代NIL节点的每条路径必须包含相同数量的黑色节点。</li>
</ol>
<p>通过为每个节点分配颜色并限制连续的着色节点数量，RBT确保最长的分支永远不会超过最短分支的两倍大小，从而提供更稳定和有效的树。</p>
<p>以下是RBT的视觉表示：</p>
<p><img data-src="https://drive.google.com/uc?export=view&id=1uj8c9Md7JGe6XXoAX6HQEvo6oaGgzPHc" alt="photo_2023-02-22_21-58-43.jpg"></p>
<p>当我们按顺序插入“1, 2, 3, 4, 5”时，以下是BST和RBT之间的比较，展示了为什么在插入排序元素时RBT远比BST有效：</p>
<p><img data-src="https://drive.google.com/uc?export=view&id=1ZgmVqbTb-yAB9iDVdC8rLuXuojKOPELT" alt="photo_2023-02-22_22-32-17.jpg"></p>
<p>很明显，当收到排序序列时，BST将变得非常低效。而RBT在此情况下可以更加平衡。</p>
<h2 id="红黑树函数"><a href="#红黑树函数" class="headerlink" title="红黑树函数"></a>红黑树函数</h2><p>红黑树支持以下函数：</p>
<ol>
<li><p>插入：要将新节点插入红黑树中，我们首先创建一个具有给定键和值的新节点。然后，我们遍历树以找到插入新节点的正确位置。如果树为空，我们将新节点简单地作为树的根。如果树不为空，我们将新节点的键与当前正在检查的节点的键进行比较。如果新节点的键小于当前节点的键，则移动到当前节点的左子节点。如果新节点的键大于当前节点的键，则移动到当前节点的右子节点。我们重复这个过程，直到我们找到一个可以插入新节点的空位置。</p>
</li>
<li><p>删除：要从红黑树中删除节点，我们首先搜索具有给定键的节点。如果找不到节点，我们简单地返回而不做任何事情。如果找到节点，我们用其后继节点替换它，后继节点是节点右子树中键值最小的节点。然后，我们使用类似的过程从树中删除后继节点。</p>
</li>
<li><p>搜索：在红黑树中搜索节点类似于在二叉搜索树中搜索。我们从根节点开始，将给定键与当前节点的键进行比较。如果键相等，我们返回当前节点的值。如果给定键小于当前节点的键，我们移动到左子节点。如果给定键大于当前节点的键，则移动到右子节点。我们重复这个过程，直到我们找到具有给定键的节点或到达叶子节点。</p>
</li>
</ol>
<h2 id="Rust中的红黑树代码"><a href="#Rust中的红黑树代码" class="headerlink" title="Rust中的红黑树代码"></a>Rust中的红黑树代码</h2><p>要在Rust中实现红黑树，我们首先定义一个Node结构来表示树中的每个节点。Node结构包含节点的键，值，颜色和左右子节点字段。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;   <span class="comment">// Defines an enum called &#x27;Color&#x27;</span></span><br><span class="line">    Red,      <span class="comment">// Enum variant representing the color red</span></span><br><span class="line">    Black,    <span class="comment">// Enum variant representing the color black</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&lt;K, V&gt; &#123;    <span class="comment">// Defines a struct called &#x27;Node&#x27; with generic parameters &#x27;K&#x27; and &#x27;V&#x27;</span></span><br><span class="line">    key: K,            <span class="comment">// Field representing the key of the node</span></span><br><span class="line">    value: V,          <span class="comment">// Field representing the value of the node</span></span><br><span class="line">    color: Color,      <span class="comment">// Field representing the color of the node, which is of type &#x27;Color&#x27; enum</span></span><br><span class="line">    left: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;Node&lt;K, V&gt;&gt;&gt;,   <span class="comment">// Field representing the left child node of the current node (if exists); it is an Option type and wrapped inside a box</span></span><br><span class="line">    right: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;Node&lt;K, V&gt;&gt;&gt;,  <span class="comment">// Field representing the right child node of the current node (if exists); it is an Option type and wrapped inside a box</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们还定义了一个RBTree结构来表示整个红黑树。RBTree结构包含一个根节点和用于插入，删除和搜索树中元素的方法。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">RBTree</span>&lt;K: <span class="built_in">Ord</span>, V&gt; &#123;   <span class="comment">// Defines a struct called &#x27;RBTree&#x27; with generic parameters &#x27;K&#x27; and &#x27;V&#x27;; &#x27;K&#x27; must implement &#x27;Ord&#x27; trait</span></span><br><span class="line">    root: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;Node&lt;K, V&gt;&gt;&gt;,   <span class="comment">// Field representing the root node of the red-black tree; it is an Option type and wrapped inside a box</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="左旋和右旋"><a href="#左旋和右旋" class="headerlink" title="左旋和右旋"></a>左旋和右旋</h3><p>这些函数执行给定节点及其子节点的左旋或右旋操作。rotate_left函数接收一个可变引用到一个节点，并将其右子节点向左旋转，而rotate_right函数接收一个可变引用到一个节点，并将其左子节点向右旋转。</p>
<p>在每次旋转期间，适当的指针被更新以反映树的新结构。每个节点的大小也被更新以反映旋转过程中发生的任何更改。</p>
<p>这些旋转函数由fix_after_insertion和fix_after_deletion方法用于维护红黑树的平衡属性。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;K: <span class="built_in">Ord</span>, V&gt; RBTree&lt;K, V&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Defines a private method called &#x27;rotate_left&#x27; that takes a mutable reference to a &#x27;Node&#x27; struct</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">rotate_left</span>(<span class="keyword">mut</span> node: &amp;<span class="keyword">mut</span> Node&lt;K, V&gt;) &#123;</span><br><span class="line">        <span class="comment">// Takes ownership of the right child node of the given node</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">right</span> = node.right.<span class="title function_ invoke__">take</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Moves the left child of the right child node to the right child of the given node</span></span><br><span class="line">        node.right = right.left.<span class="title function_ invoke__">take</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the right child node as the given node and returns the right child node</span></span><br><span class="line">        right.left = <span class="title function_ invoke__">Some</span>(std::mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> node, right));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the left child node of the given node to the given node</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> left) = node.left &#123;</span><br><span class="line">            left.parent = <span class="title function_ invoke__">Some</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the right child node of the given node to the given node</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> right) = node.right &#123;</span><br><span class="line">            right.parent = <span class="title function_ invoke__">Some</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Updates the size of the given node</span></span><br><span class="line">        node.<span class="title function_ invoke__">update_size</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Defines a private method called &#x27;rotate_right&#x27; that takes a mutable reference to a &#x27;Node&#x27; struct</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">rotate_right</span>(<span class="keyword">mut</span> node: &amp;<span class="keyword">mut</span> Node&lt;K, V&gt;) &#123;</span><br><span class="line">        <span class="comment">// Takes ownership of the left child node of the given node</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">left</span> = node.left.<span class="title function_ invoke__">take</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Moves the right child of the left child node to the left child of the given node</span></span><br><span class="line">        node.left = left.right.<span class="title function_ invoke__">take</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the left child node as the given node and returns the left child node</span></span><br><span class="line">        left.right = <span class="title function_ invoke__">Some</span>(std::mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> node, left));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the left child node of the given node to the given node</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> left) = node.left &#123;</span><br><span class="line">            left.parent = <span class="title function_ invoke__">Some</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the right child node of the given node to the given node</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> right) = node.right &#123;</span><br><span class="line">            right.parent = <span class="title function_ invoke__">Some</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Updates the size of the given node</span></span><br><span class="line">        node.<span class="title function_ invoke__">update_size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="插入函数"><a href="#插入函数" class="headerlink" title="插入函数"></a>插入函数</h3><p>插入函数遵循之前描述的插入函数相同的逻辑。我们创建一个具有给定键和值的新节点，并遍历树以找到插入新节点的正确位置。如果树为空，我们将新节点简单地作为树的根。如果树不为空，我们将新节点的键与当前正在检查的节点的键进行比较。如果新节点的键小于当前节点的键，则移动到当前节点的左子节点。如果新节点的键大于当前节点的键，则移动到当前节点的右子节点。我们重复这个过程，直到我们找到一个可以插入新节点的空位置。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;K: <span class="built_in">Ord</span>, V&gt; RBTree&lt;K, V&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Defines a private method called &#x27;fix_after_insertion&#x27; that takes a mutable reference to a &#x27;Node&#x27; struct and an optional mutable reference to the root node</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fix_after_insertion</span>(</span><br><span class="line">        <span class="keyword">mut</span> node: &amp;<span class="keyword">mut</span> Node&lt;K, V&gt;,</span><br><span class="line">        root: <span class="type">Option</span>&lt;&amp;<span class="keyword">mut</span> <span class="type">Box</span>&lt;Node&lt;K, V&gt;&gt;&gt;,</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="comment">// Sets the color of the inserted node as &#x27;Red&#x27;</span></span><br><span class="line">        node.color = Color::Red;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Checks if the node is not the root node and its parent&#x27;s color is &#x27;Red&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> node != root.<span class="title function_ invoke__">unwrap</span>() &amp;&amp; node.<span class="title function_ invoke__">parent</span>().<span class="title function_ invoke__">unwrap</span>().color == Color::Red &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">parent</span> = node.<span class="title function_ invoke__">parent</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">grandparent</span> = node.<span class="title function_ invoke__">grandparent</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Checks if the parent is the left child of its grandparent</span></span><br><span class="line">            <span class="keyword">if</span> parent == grandparent.left.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>() &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">uncle</span> = grandparent.right.<span class="title function_ invoke__">as_ref</span>();</span><br><span class="line">                <span class="comment">// Checks if the uncle node exists and its color is &#x27;Red&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> uncle.<span class="title function_ invoke__">is_some</span>() &amp;&amp; uncle.<span class="title function_ invoke__">unwrap</span>().color == Color::Red &#123;</span><br><span class="line">                    <span class="comment">// Recolors the parent, uncle, and grandparent nodes, and sets the current node to its grandparent</span></span><br><span class="line">                    parent.color = Color::Black;</span><br><span class="line">                    uncle.<span class="title function_ invoke__">unwrap</span>().color = Color::Black;</span><br><span class="line">                    grandparent.color = Color::Red;</span><br><span class="line">                    node = grandparent;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// Checks if the current node is the right child of its parent; if so, rotates it to the left around the parent node</span></span><br><span class="line">                    <span class="keyword">if</span> node == parent.right.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>() &#123;</span><br><span class="line">                        node = parent;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_left</span>(parent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// Recolors the parent and grandparent nodes, and rotates the grandparent node to the right</span></span><br><span class="line">                    parent.color = Color::Black;</span><br><span class="line">                    grandparent.color = Color::Red;</span><br><span class="line">                    RBTree::<span class="title function_ invoke__">rotate_right</span>(grandparent);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">uncle</span> = grandparent.left.<span class="title function_ invoke__">as_ref</span>();</span><br><span class="line">                <span class="comment">// Checks if the uncle node exists and its color is &#x27;Red&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> uncle.<span class="title function_ invoke__">is_some</span>() &amp;&amp; uncle.<span class="title function_ invoke__">unwrap</span>().color == Color::Red &#123;</span><br><span class="line">                    <span class="comment">// Recolors the parent, uncle, and grandparent nodes, and sets the current node to its grandparent</span></span><br><span class="line">                    parent.color = Color::Black;</span><br><span class="line">                    uncle.<span class="title function_ invoke__">unwrap</span>().color = Color::Black;</span><br><span class="line">                    grandparent.color = Color::Red;</span><br><span class="line">                    node = grandparent;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// Checks if the current node is the left child of its parent; if so, rotates it to the right around the parent node</span></span><br><span class="line">                    <span class="keyword">if</span> node == parent.left.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>() &#123;</span><br><span class="line">                        node = parent;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(parent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// Recolors the parent and grandparent nodes, and rotates the grandparent node to the left</span></span><br><span class="line">                    parent.color = Color::Black;</span><br><span class="line">                    grandparent.color = Color::Red;</span><br><span class="line">                    RBTree::<span class="title function_ invoke__">rotate_left</span>(grandparent);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        root.<span class="title function_ invoke__">unwrap</span>().color = Color::Black;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Defines a public method called &#x27;insert&#x27; that takes a key and a value and adds it to the red-black tree</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">insert</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, key: K, value: V) &#123;</span><br><span class="line">        <span class="comment">// Creates a new node with the given key, value, and color &#x27;Red&#x27;</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">new_node</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Node &#123;</span><br><span class="line">            key,</span><br><span class="line">            value,</span><br><span class="line">            color: Color::Red,</span><br><span class="line">            left: <span class="literal">None</span>,</span><br><span class="line">            right: <span class="literal">None</span>,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Checks if the root node exists</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> root) = <span class="keyword">self</span>.root &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current</span> = root.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line">            <span class="comment">// Traverses through the tree until it finds a suitable place to insert the new node</span></span><br><span class="line">            <span class="keyword">loop</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> new_node.key &lt; current.key &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> left) = current.left &#123;</span><br><span class="line">                        current = left.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        current.left = <span class="title function_ invoke__">Some</span>(new_node);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> new_node.key &gt; current.key &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> right) = current.right &#123;</span><br><span class="line">                        current = right.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        current.right = <span class="title function_ invoke__">Some</span>(new_node);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// If the key already exists in the tree, updates its corresponding value and exits the loop</span></span><br><span class="line">                    current.value = new_node.value;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Fixes the tree after insertion of the new node</span></span><br><span class="line">            RBTree::<span class="title function_ invoke__">fix_after_insertion</span>(current, <span class="title function_ invoke__">Some</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>.root));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// If the root node does not exist, sets the color of the new node as &#x27;Black&#x27; and makes it the root node</span></span><br><span class="line">            new_node.color = Color::Black;</span><br><span class="line">            <span class="keyword">self</span>.root = <span class="title function_ invoke__">Some</span>(new_node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<h3 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a>删除函数</h3><p>删除函数也遵循之前描述的删除函数相同的逻辑。我们搜索具有给定键的节点，并用其后继节点替换它，后继节点是节点右子树中键值最小的节点。然后，我们使用类似的过程从树中删除后继节点。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This function fixes the Red-Black Tree violations that may arise after a node deletion</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">fix_after_deletion</span>(</span><br><span class="line">    <span class="keyword">mut</span> node: &amp;<span class="keyword">mut</span> Node&lt;K, V&gt;,</span><br><span class="line">    root: <span class="type">Option</span>&lt;&amp;<span class="keyword">mut</span> <span class="type">Box</span>&lt;Node&lt;K, V&gt;&gt;&gt;,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">while</span> node != root.<span class="title function_ invoke__">unwrap</span>() &amp;&amp; node.color == Color::Black &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the parent and sibling of the current node</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">parent</span> = node.<span class="title function_ invoke__">parent_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">sibling</span> = node.<span class="title function_ invoke__">sibling</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> sibling.color == Color::Red &#123;</span><br><span class="line">            <span class="comment">// Case 1: The sibling of the current node is red</span></span><br><span class="line">            <span class="comment">// Change the colors of the parent, sibling, and the child of the sibling</span></span><br><span class="line">            sibling.color = Color::Black;</span><br><span class="line">            parent.color = Color::Red;</span><br><span class="line">            <span class="keyword">if</span> node.<span class="title function_ invoke__">is_left_child</span>() &#123;</span><br><span class="line">                <span class="comment">// Rotate left if the current node is the left child</span></span><br><span class="line">                RBTree::<span class="title function_ invoke__">rotate_left</span>(parent);</span><br><span class="line">                sibling.color = parent.right.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>().color;</span><br><span class="line">                parent.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>().color = Color::Black;</span><br><span class="line">                node = parent.left.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Rotate right if the current node is the right child</span></span><br><span class="line">                RBTree::<span class="title function_ invoke__">rotate_right</span>(parent);</span><br><span class="line">                sibling.color = parent.left.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>().color;</span><br><span class="line">                parent.left.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>().color = Color::Black;</span><br><span class="line">                node = parent.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> (<span class="title function_ invoke__">Some</span>(left), <span class="title function_ invoke__">Some</span>(right)) = (sibling.left.<span class="title function_ invoke__">as_ref</span>(), sibling.right.<span class="title function_ invoke__">as_ref</span>()) &#123;</span><br><span class="line">                <span class="keyword">if</span> left.color == Color::Black &amp;&amp; right.color == Color::Black &#123;</span><br><span class="line">                    <span class="comment">// Case 2: The sibling of the current node is black and both its children are black</span></span><br><span class="line">                    <span class="comment">// Change the colors of the sibling and move up to the parent</span></span><br><span class="line">                    sibling.color = Color::Red;</span><br><span class="line">                    node = parent;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> node.<span class="title function_ invoke__">is_left_child</span>() &amp;&amp; right.color == Color::Black &#123;</span><br><span class="line">                        <span class="comment">// Case 3: The sibling of the current node is black and the right child is black</span></span><br><span class="line">                        <span class="comment">// Change the colors of the sibling and its left child, and rotate right</span></span><br><span class="line">                        sibling.color = Color::Red;</span><br><span class="line">                        left.color = Color::Black;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(sibling);</span><br><span class="line">                        sibling = parent.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> node.<span class="title function_ invoke__">is_right_child</span>() &amp;&amp; left.color == Color::Black &#123;</span><br><span class="line">                        <span class="comment">// Case 3: The sibling of the current node is black and the left child is black</span></span><br><span class="line">                        <span class="comment">// Change the colors of the sibling and its right child, and rotate left</span></span><br><span class="line">                        sibling.color = Color::Red;</span><br><span class="line">                        right.color = Color::Black;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_left</span>(sibling);</span><br><span class="line">                        sibling = parent.left.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Case 4: The sibling of the current node is black and has a red child</span></span><br><span class="line">                    <span class="comment">// Change the colors of the parent, sibling, and the child of the sibling</span></span><br><span class="line">                    sibling.color = parent.color;</span><br><span class="line">                    parent.color = Color::Black;</span><br><span class="line">                    <span class="keyword">if</span> node.<span class="title function_ invoke__">is_left_child</span>() &#123;</span><br><span class="line">                        right.color = Color::Black;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_left</span>(parent);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        left.color = Color::Black;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(parent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Case 2: The sibling of the current node is black and has no children</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(left) = sibling.left.<span class="title function_ invoke__">as_ref</span>() &#123;</span><br><span class="line">                    <span class="keyword">if</span> node.<span class="title function_ invoke__">is_left_child</span>() &#123;</span><br><span class="line">                        <span class="comment">// Change the color of the sibling&#x27;s left child and rotate right</span></span><br><span class="line">                        left.color = Color::Black;</span><br><span class="line">                        sibling.color = parent.color;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(parent);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// Change the color of the sibling and its left child, and rotate right</span></span><br><span class="line">                        left.color = Color::Red;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(sibling);</span><br><span class="line">                        sibling = parent.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> node.<span class="title function_ invoke__">is_left_child</span>() &#123;</span><br><span class="line">                        <span class="comment">// Change the color of the sibling and its left child, and rotate right</span></span><br><span class="line">                        sibling.color = Color::Red;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(sibling);</span><br><span class="line">                        sibling = parent.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// Change the colors of the parent and sibling, and rotate left</span></span><br><span class="line">                        sibling.color = parent.color;</span><br><span class="line">                        parent.color = Color::Black;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_left</span>(parent);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the color of the current node to black</span></span><br><span class="line">    node.color = Color::Black;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// This function deletes a node from the Red-Black Tree according to the given key</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">delete</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, key: &amp;K) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;V&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current</span> = <span class="keyword">self</span>.root.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(node) = current &#123;</span><br><span class="line">        <span class="keyword">if</span> key &lt; &amp;node.key &#123;</span><br><span class="line">            current = node.left.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> key &gt; &amp;node.key &#123;</span><br><span class="line">            current = node.right.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> node.left.<span class="title function_ invoke__">is_some</span>() &amp;&amp; node.right.<span class="title function_ invoke__">is_some</span>() &#123;</span><br><span class="line">                <span class="comment">// If the node has two children, replace it with its successor and delete the successor</span></span><br><span class="line">                <span class="keyword">let</span> <span class="variable">successor</span> = node.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">min_node</span>();</span><br><span class="line">                node.key = successor.key;</span><br><span class="line">                node.value = std::mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> successor.value, <span class="built_in">Default</span>::<span class="title function_ invoke__">default</span>());</span><br><span class="line">                current = <span class="title function_ invoke__">Some</span>(&amp;<span class="keyword">mut</span> *successor);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// If the node has one child or no children, remove it and fix any Red-Black Tree violations</span></span><br><span class="line">                <span class="keyword">let</span> <span class="variable">child</span> = <span class="keyword">if</span> node.left.<span class="title function_ invoke__">is_some</span>() &#123;</span><br><span class="line">                    node.left.<span class="title function_ invoke__">take</span>()</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    node.right.<span class="title function_ invoke__">take</span>()</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> node.color == Color::Black &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> c) = child &#123;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">fix_after_deletion</span>(c.<span class="title function_ invoke__">as_mut</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>.root));</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">fix_after_deletion</span>(node, <span class="title function_ invoke__">Some</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>.root));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">Some</span>(node.value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="literal">None</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="搜索函数"><a href="#搜索函数" class="headerlink" title="搜索函数"></a>搜索函数</h3><p>搜索函数与之前描述的搜索函数类似。我们从根节点开始，将给定键与当前节点的键进行比较。如果键相等，我们返回当前节点的值。如果给定键小于当前节点的键，我们移动到左子节点。如果给定键大于当前节点的键，则移动到右子节点。我们重复这个过程，直到我们找到具有给定键的节点或到达叶子节点。</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;K: <span class="built_in">Ord</span>, V&gt; RBTree&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">search</span>(&amp;<span class="keyword">self</span>, key: &amp;K) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;&amp;V&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current</span> = <span class="keyword">self</span>.root.<span class="title function_ invoke__">as_ref</span>(); <span class="comment">// Start search from the root of the tree.</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(node) = current &#123; <span class="comment">// Traverse the tree until the key is found or a leaf node is reached.</span></span><br><span class="line">            <span class="keyword">if</span> key == &amp;node.key &#123; <span class="comment">// If the key is found, return the corresponding value.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">Some</span>(&amp;node.value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> key &lt; &amp;node.key &#123; <span class="comment">// If the key is less than the current node&#x27;s key, search the left subtree.</span></span><br><span class="line">                current = node.left.<span class="title function_ invoke__">as_ref</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// If the key is greater than the current node&#x27;s key, search the right subtree.</span></span><br><span class="line">                current = node.right.<span class="title function_ invoke__">as_ref</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="literal">None</span> <span class="comment">// If the key is not found, return None.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>红黑树是一种自平衡的二叉搜索树，用于按排序顺序存储和检索元素，所有主要操作的时间复杂度为O(log n)。它们旨在具有内存效率和平衡性，使其比其他平衡树如AVL树更有效率。Rust是一种现代编程语言，旨在提高性能和安全性，因此它是实现数据结构如红黑树的绝佳选择。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
    <link itemprop="mainEntityOfPage" href="https://dawn-cmd.github.io/2023/02/22/Red-Black-Tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="HuaiYuan Jing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Developer Biography">
      <meta itemprop="description" content="history of blood and tear">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Developer Biography">
      <meta itemprop="description" content>
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/02/22/Red-Black-Tree/" class="post-title-link" itemprop="url">Red Black Tree</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-02-22 21:28:39" itemprop="dateCreated datePublished" datetime="2023-02-22T21:28:39-06:00">2023-02-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-02 17:06:41" itemprop="dateModified" datetime="2024-02-02T17:06:41-06:00">2024-02-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/data-structure-algorithm/" itemprop="url" rel="index"><span itemprop="name">data structure & algorithm</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a href="https://dawn-cmd.github.io/2023/03/21/Red-Black-Tree-zh-CN/">中文版链接</a></p>
<h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>In computer science, Red-Black Trees are a type of self-balancing binary search tree that are used to store and retrieve elements in sorted order with O(log n) time complexity for all major operations. They are designed to be memory-efficient and balanced, making them more efficient than other balanced trees like AVL trees. In this article, we have discussed the implementation of Red-Black Trees in Rust, a modern programming language designed for performance and safety. We have covered the structure of the tree, as well as the functions for insertion, deletion, and searching. Additionally, we have covered the fix functions that are used to restore the height balance and color balance properties of the tree after each insertion and deletion. Finally, we have discussed the left and right rotation functions that are used to maintain the balance properties of the Red-Black Tree. By using Rust to implement Red-Black Trees, we can take advantage of the language’s performance and safety features to create an efficient and reliable data structure.</p>
<h2 id="What-is-Red-Black-Tree-RBT"><a href="#What-is-Red-Black-Tree-RBT" class="headerlink" title="What is Red Black Tree (RBT)?"></a>What is Red Black Tree (RBT)?</h2><p>Red-Black Trees are binary search trees where each node is colored either red or black. The color of the node is used to balance the tree so that the longest path from the root to any leaf node is no more than twice as long as the shortest path from the root to any other leaf node. This property is known as the height balance property.</p>
<h2 id="Red-Black-Trees-are-constructed-with-the-following-rules"><a href="#Red-Black-Trees-are-constructed-with-the-following-rules" class="headerlink" title="Red-Black Trees are constructed with the following rules"></a>Red-Black Trees are constructed with the following rules</h2><ol>
<li>Each node is either red or black.</li>
<li>The root node is always black.</li>
<li>Every leaf (NIL) node is black.</li>
<li>If a node is red, then both its children must be black.</li>
<li>Every path from a given node to any of its descendant NIL nodes must contain the same number of black nodes.</li>
</ol>
<p>By assigning each node with a color and by limiting the number of consecutive colored nodes, RBT ensures that the longest branches will never exceed twice the size of the shortest branches, thus providing a more stable and effective tree. For reference, here’s a visual representation of an RBT:</p>
<p><img data-src="https://drive.google.com/uc?export=view&id=1uj8c9Md7JGe6XXoAX6HQEvo6oaGgzPHc" alt="photo_2023-02-22_21-58-43.jpg"></p>
<p>Here’s a comparison between BST and RBT when we insert “1, 2, 3, 4, 5” in order, demonstrating why RBT is far more efficient than BST when sorted elements are inserted:</p>
<p><img data-src="https://drive.google.com/uc?export=view&id=1ZgmVqbTb-yAB9iDVdC8rLuXuojKOPELT" alt="photo_2023-02-22_22-32-17.jpg"></p>
<p>Obviously, BST will become extremely low effective when receiving a sorted sequence. And RBT can become more balanced under this situation.</p>
<h2 id="Red-Black-Tree-Functions"><a href="#Red-Black-Tree-Functions" class="headerlink" title="Red-Black Tree Functions"></a>Red-Black Tree Functions</h2><p>A Red-Black Tree supports the following functions:</p>
<ol>
<li><p>Insertion: To insert a new node into the Red-Black Tree, we first create a new node with the given key and value. We then traverse the tree to find the correct location to insert the new node. If the tree is empty, we simply make the new node the root of the tree. If the tree is not empty, we compare the new node’s key to the key of the current node we are examining. If the new node’s key is less than the current node’s key, we move to the left child of the current node. If the new node’s key is greater than the current node’s key, we move to the right child of the current node. We repeat this process until we find an empty location in the tree where we can insert the new node.</p>
</li>
<li><p>Deletion: To delete a node from the Red-Black Tree, we first search for the node with the given key. If the node is not found, we simply return without doing anything. If the node is found, we replace it with its successor, which is the node with the smallest key in the node’s right subtree. We then delete the successor node from the tree using a similar process.</p>
</li>
<li><p>Searching: Searching for a node in the Red-Black Tree is similar to searching in a binary search tree. We start at the root node and compare the given key with the key of the current node. If the keys are equal, we return the value of the current node. If the given key is less than the key of the current node, we move to the left child. If the given key is greater than the key of the current node, we move to the right child. We repeat this process until we find the node with the given key or reach a leaf node.</p>
</li>
</ol>
<h2 id="Rust-Code-for-Red-Black-Trees"><a href="#Rust-Code-for-Red-Black-Trees" class="headerlink" title="Rust Code for Red-Black Trees"></a>Rust Code for Red-Black Trees</h2><p>To implement Red-Black Trees in Rust, we first define a Node struct to represent each node in the tree. The Node struct contains fields for the node’s key, value, color, and left and right children.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span> &#123;   <span class="comment">// Defines an enum called &#x27;Color&#x27;</span></span><br><span class="line">    Red,      <span class="comment">// Enum variant representing the color red</span></span><br><span class="line">    Black,    <span class="comment">// Enum variant representing the color black</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span>&lt;K, V&gt; &#123;    <span class="comment">// Defines a struct called &#x27;Node&#x27; with generic parameters &#x27;K&#x27; and &#x27;V&#x27;</span></span><br><span class="line">    key: K,            <span class="comment">// Field representing the key of the node</span></span><br><span class="line">    value: V,          <span class="comment">// Field representing the value of the node</span></span><br><span class="line">    color: Color,      <span class="comment">// Field representing the color of the node, which is of type &#x27;Color&#x27; enum</span></span><br><span class="line">    left: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;Node&lt;K, V&gt;&gt;&gt;,   <span class="comment">// Field representing the left child node of the current node (if exists); it is an Option type and wrapped inside a box</span></span><br><span class="line">    right: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;Node&lt;K, V&gt;&gt;&gt;,  <span class="comment">// Field representing the right child node of the current node (if exists); it is an Option type and wrapped inside a box</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We also define an RBTree struct to represent the Red-Black Tree as a whole. The RBTree struct contains a root node and methods to insert, delete, and search for elements in the tree.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">struct</span> <span class="title class_">RBTree</span>&lt;K: <span class="built_in">Ord</span>, V&gt; &#123;   <span class="comment">// Defines a struct called &#x27;RBTree&#x27; with generic parameters &#x27;K&#x27; and &#x27;V&#x27;; &#x27;K&#x27; must implement &#x27;Ord&#x27; trait</span></span><br><span class="line">    root: <span class="type">Option</span>&lt;<span class="type">Box</span>&lt;Node&lt;K, V&gt;&gt;&gt;,   <span class="comment">// Field representing the root node of the red-black tree; it is an Option type and wrapped inside a box</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Left-and-Right-Rotate"><a href="#Left-and-Right-Rotate" class="headerlink" title="Left and Right Rotate"></a>Left and Right Rotate</h3><p>These functions perform a left or right rotation of a given node and its children. The rotate_left function takes in a mutable reference to a node and rotates its right child to the left, while the rotate_right function takes in a mutable reference to a node and rotates its left child to the right.</p>
<p>During each rotation, the appropriate pointers are updated to reflect the new structure of the tree. The size of each node is also updated to reflect any changes that occurred during the rotation.</p>
<p>These rotation functions are used by the fix_after_insertion and fix_after_deletion methods to maintain the balance properties of the Red-Black Tree.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;K: <span class="built_in">Ord</span>, V&gt; RBTree&lt;K, V&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Defines a private method called &#x27;rotate_left&#x27; that takes a mutable reference to a &#x27;Node&#x27; struct</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">rotate_left</span>(<span class="keyword">mut</span> node: &amp;<span class="keyword">mut</span> Node&lt;K, V&gt;) &#123;</span><br><span class="line">        <span class="comment">// Takes ownership of the right child node of the given node</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">right</span> = node.right.<span class="title function_ invoke__">take</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Moves the left child of the right child node to the right child of the given node</span></span><br><span class="line">        node.right = right.left.<span class="title function_ invoke__">take</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the right child node as the given node and returns the right child node</span></span><br><span class="line">        right.left = <span class="title function_ invoke__">Some</span>(std::mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> node, right));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the left child node of the given node to the given node</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> left) = node.left &#123;</span><br><span class="line">            left.parent = <span class="title function_ invoke__">Some</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the right child node of the given node to the given node</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> right) = node.right &#123;</span><br><span class="line">            right.parent = <span class="title function_ invoke__">Some</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Updates the size of the given node</span></span><br><span class="line">        node.<span class="title function_ invoke__">update_size</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Defines a private method called &#x27;rotate_right&#x27; that takes a mutable reference to a &#x27;Node&#x27; struct</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">rotate_right</span>(<span class="keyword">mut</span> node: &amp;<span class="keyword">mut</span> Node&lt;K, V&gt;) &#123;</span><br><span class="line">        <span class="comment">// Takes ownership of the left child node of the given node</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">left</span> = node.left.<span class="title function_ invoke__">take</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Moves the right child of the left child node to the left child of the given node</span></span><br><span class="line">        node.left = left.right.<span class="title function_ invoke__">take</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the left child node as the given node and returns the left child node</span></span><br><span class="line">        left.right = <span class="title function_ invoke__">Some</span>(std::mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> node, left));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the left child node of the given node to the given node</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> left) = node.left &#123;</span><br><span class="line">            left.parent = <span class="title function_ invoke__">Some</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Sets the parent of the right child node of the given node to the given node</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> right) = node.right &#123;</span><br><span class="line">            right.parent = <span class="title function_ invoke__">Some</span>(node);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Updates the size of the given node</span></span><br><span class="line">        node.<span class="title function_ invoke__">update_size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Insertion-Function-in-Rust"><a href="#Insertion-Function-in-Rust" class="headerlink" title="Insertion Function in Rust"></a>Insertion Function in Rust</h3><p>The insert function in Rust follows the same logic as the insertion function described earlier. We create a new node with the given key and value and traverse the tree to find the correct location to insert the new node. If the tree is empty, we simply make the new node the root of the tree. If the tree is not empty, we compare the new node’s key to the key of the current node we are examining. If the new node’s key is less than the current node’s key, we move to the left child of the current node. If the new node’s key is greater than the current node’s key, we move to the right child of the current node. We repeat this process until we find an empty location in the tree where we can insert the new node.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;K: <span class="built_in">Ord</span>, V&gt; RBTree&lt;K, V&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Defines a private method called &#x27;fix_after_insertion&#x27; that takes a mutable reference to a &#x27;Node&#x27; struct and an optional mutable reference to the root node</span></span><br><span class="line">    <span class="keyword">fn</span> <span class="title function_">fix_after_insertion</span>(</span><br><span class="line">        <span class="keyword">mut</span> node: &amp;<span class="keyword">mut</span> Node&lt;K, V&gt;,</span><br><span class="line">        root: <span class="type">Option</span>&lt;&amp;<span class="keyword">mut</span> <span class="type">Box</span>&lt;Node&lt;K, V&gt;&gt;&gt;,</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="comment">// Sets the color of the inserted node as &#x27;Red&#x27;</span></span><br><span class="line">        node.color = Color::Red;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Checks if the node is not the root node and its parent&#x27;s color is &#x27;Red&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> node != root.<span class="title function_ invoke__">unwrap</span>() &amp;&amp; node.<span class="title function_ invoke__">parent</span>().<span class="title function_ invoke__">unwrap</span>().color == Color::Red &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">parent</span> = node.<span class="title function_ invoke__">parent</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">grandparent</span> = node.<span class="title function_ invoke__">grandparent</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// Checks if the parent is the left child of its grandparent</span></span><br><span class="line">            <span class="keyword">if</span> parent == grandparent.left.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>() &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">uncle</span> = grandparent.right.<span class="title function_ invoke__">as_ref</span>();</span><br><span class="line">                <span class="comment">// Checks if the uncle node exists and its color is &#x27;Red&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> uncle.<span class="title function_ invoke__">is_some</span>() &amp;&amp; uncle.<span class="title function_ invoke__">unwrap</span>().color == Color::Red &#123;</span><br><span class="line">                    <span class="comment">// Recolors the parent, uncle, and grandparent nodes, and sets the current node to its grandparent</span></span><br><span class="line">                    parent.color = Color::Black;</span><br><span class="line">                    uncle.<span class="title function_ invoke__">unwrap</span>().color = Color::Black;</span><br><span class="line">                    grandparent.color = Color::Red;</span><br><span class="line">                    node = grandparent;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// Checks if the current node is the right child of its parent; if so, rotates it to the left around the parent node</span></span><br><span class="line">                    <span class="keyword">if</span> node == parent.right.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>() &#123;</span><br><span class="line">                        node = parent;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_left</span>(parent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// Recolors the parent and grandparent nodes, and rotates the grandparent node to the right</span></span><br><span class="line">                    parent.color = Color::Black;</span><br><span class="line">                    grandparent.color = Color::Red;</span><br><span class="line">                    RBTree::<span class="title function_ invoke__">rotate_right</span>(grandparent);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> <span class="variable">uncle</span> = grandparent.left.<span class="title function_ invoke__">as_ref</span>();</span><br><span class="line">                <span class="comment">// Checks if the uncle node exists and its color is &#x27;Red&#x27;</span></span><br><span class="line">                <span class="keyword">if</span> uncle.<span class="title function_ invoke__">is_some</span>() &amp;&amp; uncle.<span class="title function_ invoke__">unwrap</span>().color == Color::Red &#123;</span><br><span class="line">                    <span class="comment">// Recolors the parent, uncle, and grandparent nodes, and sets the current node to its grandparent</span></span><br><span class="line">                    parent.color = Color::Black;</span><br><span class="line">                    uncle.<span class="title function_ invoke__">unwrap</span>().color = Color::Black;</span><br><span class="line">                    grandparent.color = Color::Red;</span><br><span class="line">                    node = grandparent;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// Checks if the current node is the left child of its parent; if so, rotates it to the right around the parent node</span></span><br><span class="line">                    <span class="keyword">if</span> node == parent.left.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>() &#123;</span><br><span class="line">                        node = parent;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(parent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// Recolors the parent and grandparent nodes, and rotates the grandparent node to the left</span></span><br><span class="line">                    parent.color = Color::Black;</span><br><span class="line">                    grandparent.color = Color::Red;</span><br><span class="line">                    RBTree::<span class="title function_ invoke__">rotate_left</span>(grandparent);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        root.<span class="title function_ invoke__">unwrap</span>().color = Color::Black;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Defines a public method called &#x27;insert&#x27; that takes a key and a value and adds it to the red-black tree</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">insert</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, key: K, value: V) &#123;</span><br><span class="line">        <span class="comment">// Creates a new node with the given key, value, and color &#x27;Red&#x27;</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">new_node</span> = <span class="type">Box</span>::<span class="title function_ invoke__">new</span>(Node &#123;</span><br><span class="line">            key,</span><br><span class="line">            value,</span><br><span class="line">            color: Color::Red,</span><br><span class="line">            left: <span class="literal">None</span>,</span><br><span class="line">            right: <span class="literal">None</span>,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Checks if the root node exists</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> root) = <span class="keyword">self</span>.root &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current</span> = root.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line">            <span class="comment">// Traverses through the tree until it finds a suitable place to insert the new node</span></span><br><span class="line">            <span class="keyword">loop</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> new_node.key &lt; current.key &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> left) = current.left &#123;</span><br><span class="line">                        current = left.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        current.left = <span class="title function_ invoke__">Some</span>(new_node);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> new_node.key &gt; current.key &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> <span class="keyword">mut</span> right) = current.right &#123;</span><br><span class="line">                        current = right.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        current.right = <span class="title function_ invoke__">Some</span>(new_node);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// If the key already exists in the tree, updates its corresponding value and exits the loop</span></span><br><span class="line">                    current.value = new_node.value;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Fixes the tree after insertion of the new node</span></span><br><span class="line">            RBTree::<span class="title function_ invoke__">fix_after_insertion</span>(current, <span class="title function_ invoke__">Some</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>.root));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// If the root node does not exist, sets the color of the new node as &#x27;Black&#x27; and makes it the root node</span></span><br><span class="line">            new_node.color = Color::Black;</span><br><span class="line">            <span class="keyword">self</span>.root = <span class="title function_ invoke__">Some</span>(new_node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Deletion-Function-in-Rust"><a href="#Deletion-Function-in-Rust" class="headerlink" title="Deletion Function in Rust"></a>Deletion Function in Rust</h3><p>The delete function in Rust also follows the same logic as the deletion function described earlier. We search for the node with the given key and replace it with its successor, which is the node with the smallest key in the node’s right subtree. We then delete the successor node from the tree using a similar process.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This function fixes the Red-Black Tree violations that may arise after a node deletion</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">fix_after_deletion</span>(</span><br><span class="line">    <span class="keyword">mut</span> node: &amp;<span class="keyword">mut</span> Node&lt;K, V&gt;,</span><br><span class="line">    root: <span class="type">Option</span>&lt;&amp;<span class="keyword">mut</span> <span class="type">Box</span>&lt;Node&lt;K, V&gt;&gt;&gt;,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">while</span> node != root.<span class="title function_ invoke__">unwrap</span>() &amp;&amp; node.color == Color::Black &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the parent and sibling of the current node</span></span><br><span class="line">        <span class="keyword">let</span> <span class="variable">parent</span> = node.<span class="title function_ invoke__">parent_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">sibling</span> = node.<span class="title function_ invoke__">sibling</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> sibling.color == Color::Red &#123;</span><br><span class="line">            <span class="comment">// Case 1: The sibling of the current node is red</span></span><br><span class="line">            <span class="comment">// Change the colors of the parent, sibling, and the child of the sibling</span></span><br><span class="line">            sibling.color = Color::Black;</span><br><span class="line">            parent.color = Color::Red;</span><br><span class="line">            <span class="keyword">if</span> node.<span class="title function_ invoke__">is_left_child</span>() &#123;</span><br><span class="line">                <span class="comment">// Rotate left if the current node is the left child</span></span><br><span class="line">                RBTree::<span class="title function_ invoke__">rotate_left</span>(parent);</span><br><span class="line">                sibling.color = parent.right.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>().color;</span><br><span class="line">                parent.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>().color = Color::Black;</span><br><span class="line">                node = parent.left.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Rotate right if the current node is the right child</span></span><br><span class="line">                RBTree::<span class="title function_ invoke__">rotate_right</span>(parent);</span><br><span class="line">                sibling.color = parent.left.<span class="title function_ invoke__">as_ref</span>().<span class="title function_ invoke__">unwrap</span>().color;</span><br><span class="line">                parent.left.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>().color = Color::Black;</span><br><span class="line">                node = parent.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> (<span class="title function_ invoke__">Some</span>(left), <span class="title function_ invoke__">Some</span>(right)) = (sibling.left.<span class="title function_ invoke__">as_ref</span>(), sibling.right.<span class="title function_ invoke__">as_ref</span>()) &#123;</span><br><span class="line">                <span class="keyword">if</span> left.color == Color::Black &amp;&amp; right.color == Color::Black &#123;</span><br><span class="line">                    <span class="comment">// Case 2: The sibling of the current node is black and both its children are black</span></span><br><span class="line">                    <span class="comment">// Change the colors of the sibling and move up to the parent</span></span><br><span class="line">                    sibling.color = Color::Red;</span><br><span class="line">                    node = parent;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> node.<span class="title function_ invoke__">is_left_child</span>() &amp;&amp; right.color == Color::Black &#123;</span><br><span class="line">                        <span class="comment">// Case 3: The sibling of the current node is black and the right child is black</span></span><br><span class="line">                        <span class="comment">// Change the colors of the sibling and its left child, and rotate right</span></span><br><span class="line">                        sibling.color = Color::Red;</span><br><span class="line">                        left.color = Color::Black;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(sibling);</span><br><span class="line">                        sibling = parent.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> node.<span class="title function_ invoke__">is_right_child</span>() &amp;&amp; left.color == Color::Black &#123;</span><br><span class="line">                        <span class="comment">// Case 3: The sibling of the current node is black and the left child is black</span></span><br><span class="line">                        <span class="comment">// Change the colors of the sibling and its right child, and rotate left</span></span><br><span class="line">                        sibling.color = Color::Red;</span><br><span class="line">                        right.color = Color::Black;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_left</span>(sibling);</span><br><span class="line">                        sibling = parent.left.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Case 4: The sibling of the current node is black and has a red child</span></span><br><span class="line">                    <span class="comment">// Change the colors of the parent, sibling, and the child of the sibling</span></span><br><span class="line">                    sibling.color = parent.color;</span><br><span class="line">                    parent.color = Color::Black;</span><br><span class="line">                    <span class="keyword">if</span> node.<span class="title function_ invoke__">is_left_child</span>() &#123;</span><br><span class="line">                        right.color = Color::Black;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_left</span>(parent);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        left.color = Color::Black;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(parent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Case 2: The sibling of the current node is black and has no children</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(left) = sibling.left.<span class="title function_ invoke__">as_ref</span>() &#123;</span><br><span class="line">                    <span class="keyword">if</span> node.<span class="title function_ invoke__">is_left_child</span>() &#123;</span><br><span class="line">                        <span class="comment">// Change the color of the sibling&#x27;s left child and rotate right</span></span><br><span class="line">                        left.color = Color::Black;</span><br><span class="line">                        sibling.color = parent.color;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(parent);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// Change the color of the sibling and its left child, and rotate right</span></span><br><span class="line">                        left.color = Color::Red;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(sibling);</span><br><span class="line">                        sibling = parent.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> node.<span class="title function_ invoke__">is_left_child</span>() &#123;</span><br><span class="line">                        <span class="comment">// Change the color of the sibling and its left child, and rotate right</span></span><br><span class="line">                        sibling.color = Color::Red;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_right</span>(sibling);</span><br><span class="line">                        sibling = parent.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// Change the colors of the parent and sibling, and rotate left</span></span><br><span class="line">                        sibling.color = parent.color;</span><br><span class="line">                        parent.color = Color::Black;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">rotate_left</span>(parent);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the color of the current node to black</span></span><br><span class="line">    node.color = Color::Black;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// This function deletes a node from the Red-Black Tree according to the given key</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">delete</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, key: &amp;K) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;V&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current</span> = <span class="keyword">self</span>.root.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(node) = current &#123;</span><br><span class="line">        <span class="keyword">if</span> key &lt; &amp;node.key &#123;</span><br><span class="line">            current = node.left.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> key &gt; &amp;node.key &#123;</span><br><span class="line">            current = node.right.<span class="title function_ invoke__">as_mut</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> node.left.<span class="title function_ invoke__">is_some</span>() &amp;&amp; node.right.<span class="title function_ invoke__">is_some</span>() &#123;</span><br><span class="line">                <span class="comment">// If the node has two children, replace it with its successor and delete the successor</span></span><br><span class="line">                <span class="keyword">let</span> <span class="variable">successor</span> = node.right.<span class="title function_ invoke__">as_mut</span>().<span class="title function_ invoke__">unwrap</span>().<span class="title function_ invoke__">min_node</span>();</span><br><span class="line">                node.key = successor.key;</span><br><span class="line">                node.value = std::mem::<span class="title function_ invoke__">replace</span>(&amp;<span class="keyword">mut</span> successor.value, <span class="built_in">Default</span>::<span class="title function_ invoke__">default</span>());</span><br><span class="line">                current = <span class="title function_ invoke__">Some</span>(&amp;<span class="keyword">mut</span> *successor);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// If the node has one child or no children, remove it and fix any Red-Black Tree violations</span></span><br><span class="line">                <span class="keyword">let</span> <span class="variable">child</span> = <span class="keyword">if</span> node.left.<span class="title function_ invoke__">is_some</span>() &#123;</span><br><span class="line">                    node.left.<span class="title function_ invoke__">take</span>()</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    node.right.<span class="title function_ invoke__">take</span>()</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> node.color == Color::Black &#123;</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">let</span> <span class="variable">Some</span>(<span class="keyword">ref</span> c) = child &#123;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">fix_after_deletion</span>(c.<span class="title function_ invoke__">as_mut</span>(), <span class="title function_ invoke__">Some</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>.root));</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        RBTree::<span class="title function_ invoke__">fix_after_deletion</span>(node, <span class="title function_ invoke__">Some</span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>.root));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">Some</span>(node.value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="literal">None</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="Searching-Function-in-Rust"><a href="#Searching-Function-in-Rust" class="headerlink" title="Searching Function in Rust"></a>Searching Function in Rust</h3><p>The <code>search</code> function in Rust is also similar to the search function described earlier. We start at the root node and compare the given key with the key of the current node. If the keys are equal, we return the value of the current node. If the given key is less than the key of the current node, we move to the left child. If the given key is greater than the key of the current node, we move to the right child. We repeat this process until we find the node with the given key or reach a leaf node.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;K: <span class="built_in">Ord</span>, V&gt; RBTree&lt;K, V&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">search</span>(&amp;<span class="keyword">self</span>, key: &amp;K) <span class="punctuation">-&gt;</span> <span class="type">Option</span>&lt;&amp;V&gt; &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">current</span> = <span class="keyword">self</span>.root.<span class="title function_ invoke__">as_ref</span>(); <span class="comment">// Start search from the root of the tree.</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">let</span> <span class="variable">Some</span>(node) = current &#123; <span class="comment">// Traverse the tree until the key is found or a leaf node is reached.</span></span><br><span class="line">            <span class="keyword">if</span> key == &amp;node.key &#123; <span class="comment">// If the key is found, return the corresponding value.</span></span><br><span class="line">                <span class="keyword">return</span> <span class="title function_ invoke__">Some</span>(&amp;node.value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> key &lt; &amp;node.key &#123; <span class="comment">// If the key is less than the current node&#x27;s key, search the left subtree.</span></span><br><span class="line">                current = node.left.<span class="title function_ invoke__">as_ref</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// If the key is greater than the current node&#x27;s key, search the right subtree.</span></span><br><span class="line">                current = node.right.<span class="title function_ invoke__">as_ref</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="literal">None</span> <span class="comment">// If the key is not found, return None.</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Red-Black Trees are a type of self-balancing binary search tree that are used to store and retrieve elements in sorted order with O(log n) time complexity for all major operations. They are designed to be memory efficient and balanced, making them more efficient than other balanced trees like AVL trees. Rust is a modern programming language that is designed for performance and safety, making it a great choice for implementing data structures like the Red-Black Tree.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">HuaiYuan Jing</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zindex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  <script src="/js/third-party/addtoany.js"></script>

  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
